<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title id="head-title">report.html</title>
      <style type="text/css">body {
  font-family: Helvetica, Arial, sans-serif;
  font-size: 12px;
  /* do not increase min-width as some may use split screens */
  min-width: 800px;
  color: #999;
}

h1 {
  font-size: 24px;
  color: black;
}

h2 {
  font-size: 16px;
  color: black;
}

p {
  color: black;
}

a {
  color: #999;
}

table {
  border-collapse: collapse;
}

/******************************
 * SUMMARY INFORMATION
 ******************************/
#environment td {
  padding: 5px;
  border: 1px solid #e6e6e6;
  vertical-align: top;
}
#environment tr:nth-child(odd) {
  background-color: #f6f6f6;
}
#environment ul {
  margin: 0;
  padding: 0 20px;
}

/******************************
 * TEST RESULT COLORS
 ******************************/
span.passed,
.passed .col-result {
  color: green;
}

span.skipped,
span.xfailed,
span.rerun,
.skipped .col-result,
.xfailed .col-result,
.rerun .col-result {
  color: orange;
}

span.error,
span.failed,
span.xpassed,
.error .col-result,
.failed .col-result,
.xpassed .col-result {
  color: red;
}

.col-links__extra {
  margin-right: 3px;
}

/******************************
 * RESULTS TABLE
 *
 * 1. Table Layout
 * 2. Extra
 * 3. Sorting items
 *
 ******************************/
/*------------------
 * 1. Table Layout
 *------------------*/
#results-table {
  border: 1px solid #e6e6e6;
  color: #999;
  font-size: 12px;
  width: 100%;
}
#results-table th,
#results-table td {
  padding: 5px;
  border: 1px solid #e6e6e6;
  text-align: left;
}
#results-table th {
  font-weight: bold;
}

/*------------------
 * 2. Extra
 *------------------*/
.logwrapper {
  max-height: 230px;
  overflow-y: scroll;
  background-color: #e6e6e6;
}
.logwrapper.expanded {
  max-height: none;
}
.logwrapper.expanded .logexpander:after {
  content: "collapse [-]";
}
.logwrapper .logexpander {
  z-index: 1;
  position: sticky;
  top: 10px;
  width: max-content;
  border: 1px solid;
  border-radius: 3px;
  padding: 5px 7px;
  margin: 10px 0 10px calc(100% - 80px);
  cursor: pointer;
  background-color: #e6e6e6;
}
.logwrapper .logexpander:after {
  content: "expand [+]";
}
.logwrapper .logexpander:hover {
  color: #000;
  border-color: #000;
}
.logwrapper .log {
  min-height: 40px;
  position: relative;
  top: -50px;
  height: calc(100% + 50px);
  border: 1px solid #e6e6e6;
  color: black;
  display: block;
  font-family: "Courier New", Courier, monospace;
  padding: 5px;
  padding-right: 80px;
  white-space: pre-wrap;
}

div.media {
  border: 1px solid #e6e6e6;
  float: right;
  height: 240px;
  margin: 0 5px;
  overflow: hidden;
  width: 320px;
}

.media-container {
  display: grid;
  grid-template-columns: 25px auto 25px;
  align-items: center;
  flex: 1 1;
  overflow: hidden;
  height: 200px;
}

.media-container--fullscreen {
  grid-template-columns: 0px auto 0px;
}

.media-container__nav--right,
.media-container__nav--left {
  text-align: center;
  cursor: pointer;
}

.media-container__viewport {
  cursor: pointer;
  text-align: center;
  height: inherit;
}
.media-container__viewport img,
.media-container__viewport video {
  object-fit: cover;
  width: 100%;
  max-height: 100%;
}

.media__name,
.media__counter {
  display: flex;
  flex-direction: row;
  justify-content: space-around;
  flex: 0 0 25px;
  align-items: center;
}

.collapsible td:not(.col-links) {
  cursor: pointer;
}
.collapsible td:not(.col-links):hover::after {
  color: #bbb;
  font-style: italic;
  cursor: pointer;
}

.col-result {
  width: 130px;
}
.col-result:hover::after {
  content: " (hide details)";
}

.col-result.collapsed:hover::after {
  content: " (show details)";
}

#environment-header h2:hover::after {
  content: " (hide details)";
  color: #bbb;
  font-style: italic;
  cursor: pointer;
  font-size: 12px;
}

#environment-header.collapsed h2:hover::after {
  content: " (show details)";
  color: #bbb;
  font-style: italic;
  cursor: pointer;
  font-size: 12px;
}

/*------------------
 * 3. Sorting items
 *------------------*/
.sortable {
  cursor: pointer;
}
.sortable.desc:after {
  content: " ";
  position: relative;
  left: 5px;
  bottom: -12.5px;
  border: 10px solid #4caf50;
  border-bottom: 0;
  border-left-color: transparent;
  border-right-color: transparent;
}
.sortable.asc:after {
  content: " ";
  position: relative;
  left: 5px;
  bottom: 12.5px;
  border: 10px solid #4caf50;
  border-top: 0;
  border-left-color: transparent;
  border-right-color: transparent;
}

.hidden, .summary__reload__button.hidden {
  display: none;
}

.summary__data {
  flex: 0 0 550px;
}
.summary__reload {
  flex: 1 1;
  display: flex;
  justify-content: center;
}
.summary__reload__button {
  flex: 0 0 300px;
  display: flex;
  color: white;
  font-weight: bold;
  background-color: #4caf50;
  text-align: center;
  justify-content: center;
  align-items: center;
  border-radius: 3px;
  cursor: pointer;
}
.summary__reload__button:hover {
  background-color: #46a049;
}
.summary__spacer {
  flex: 0 0 550px;
}

.controls {
  display: flex;
  justify-content: space-between;
}

.filters,
.collapse {
  display: flex;
  align-items: center;
}
.filters button,
.collapse button {
  color: #999;
  border: none;
  background: none;
  cursor: pointer;
  text-decoration: underline;
}
.filters button:hover,
.collapse button:hover {
  color: #ccc;
}

.filter__label {
  margin-right: 10px;
}

      </style>
    
  </head>
  <body>
    <h1 id="title">report.html</h1>
    <p>Report generated on 15-Jan-2026 at 10:08:04 by <a href="https://pypi.python.org/pypi/pytest-html">pytest-html</a>
        v4.1.1</p>
    <div id="environment-header">
      <h2>Environment</h2>
    </div>
    <table id="environment"></table>
    <!-- TEMPLATES -->
      <template id="template_environment_row">
      <tr>
        <td></td>
        <td></td>
      </tr>
    </template>
    <template id="template_results-table__body--empty">
      <tbody class="results-table-row">
        <tr id="not-found-message">
          <td colspan="4">No results found. Check the filters.</th>
        </tr>
    </template>
    <template id="template_results-table__tbody">
      <tbody class="results-table-row">
        <tr class="collapsible">
        </tr>
        <tr class="extras-row">
          <td class="extra" colspan="4">
            <div class="extraHTML"></div>
            <div class="media">
              <div class="media-container">
                  <div class="media-container__nav--left"><</div>
                  <div class="media-container__viewport">
                    <img src="" />
                    <video controls>
                      <source src="" type="video/mp4">
                    </video>
                  </div>
                  <div class="media-container__nav--right">></div>
                </div>
                <div class="media__name"></div>
                <div class="media__counter"></div>
            </div>
            <div class="logwrapper">
              <div class="logexpander"></div>
              <div class="log"></div>
            </div>
          </td>
        </tr>
      </tbody>
    </template>
    <!-- END TEMPLATES -->
    <div class="summary">
      <div class="summary__data">
        <h2>Summary</h2>
        <div class="additional-summary prefix">
        </div>
        <p class="run-count">48 tests took 00:00:26.</p>
        <p class="filter">(Un)check the boxes to filter the results.</p>
        <div class="summary__reload">
          <div class="summary__reload__button hidden" onclick="location.reload()">
            <div>There are still tests running. <br />Reload this page to get the latest results!</div>
          </div>
        </div>
        <div class="summary__spacer"></div>
        <div class="controls">
          <div class="filters">
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="failed" />
            <span class="failed">37 Failed,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="passed" />
            <span class="passed">11 Passed,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="skipped" disabled/>
            <span class="skipped">0 Skipped,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="xfailed" disabled/>
            <span class="xfailed">0 Expected failures,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="xpassed" disabled/>
            <span class="xpassed">0 Unexpected passes,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="error" disabled/>
            <span class="error">0 Errors,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="rerun" disabled/>
            <span class="rerun">0 Reruns</span>
          </div>
          <div class="collapse">
            <button id="show_all_details">Show all details</button>&nbsp;/&nbsp;<button id="hide_all_details">Hide all details</button>
          </div>
        </div>
      </div>
      <div class="additional-summary summary">
      </div>
      <div class="additional-summary postfix">
      </div>
    </div>
    <table id="results-table">
      <thead id="results-table-head">
        <tr>
          <th class="sortable" data-column-type="result">Result</th>
          <th class="sortable" data-column-type="testId">Test</th>
          <th class="sortable" data-column-type="duration">Duration</th>
          <th>Links</th>
        </tr>
      </thead>
    </table>
  </body>
  <footer>
    <div id="data-container" data-jsonblob="{&#34;environment&#34;: {&#34;Python&#34;: &#34;3.13.2&#34;, &#34;Platform&#34;: &#34;Linux-6.8.0-90-generic-x86_64-with-glibc2.39&#34;, &#34;Packages&#34;: {&#34;pytest&#34;: &#34;8.4.2&#34;, &#34;pluggy&#34;: &#34;1.6.0&#34;}, &#34;Plugins&#34;: {&#34;html&#34;: &#34;4.1.1&#34;, &#34;bdd&#34;: &#34;8.1.0&#34;, &#34;metadata&#34;: &#34;3.1.1&#34;, &#34;asyncio&#34;: &#34;1.3.0&#34;, &#34;md-report&#34;: &#34;0.7.0&#34;, &#34;anyio&#34;: &#34;4.12.0&#34;}}, &#34;tests&#34;: {&#34;test_fixture.py::test_dummy_fixture&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_fixture.py::test_dummy_fixture&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_fixture.py::test_dummy_fixture&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;No log output captured.&#34;}], &#34;test_fixture.py::test_dummy_async_fixture&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_fixture.py::test_dummy_async_fixture&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_fixture.py::test_dummy_async_fixture&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log setup ------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n&#34;}], &#34;test_openapi.py::test_swagger_flow_service&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_openapi.py::test_swagger_flow_service&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_openapi.py::test_swagger_flow_service&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;def test_swagger_flow_service():\n        url = &amp;#x27;???&amp;#x27;\n&amp;gt;       _test_swagger(\n            url,\n            &amp;quot;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE A - PR XP Z12-013 - AFNOR-Flow_Service-1.1.0-swagger.json&amp;quot;,\n        )\n\ntest_openapi.py:24: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nurl = &amp;#x27;???&amp;#x27;, swagger = &amp;#x27;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE A - PR XP Z12-013 - AFNOR-Flow_Service-1.1.0-swagger.json&amp;#x27;\n\n    def _test_swagger(url: str, swagger: str):\n        &amp;quot;&amp;quot;&amp;quot;\n            V\u00e9rifier si une API respecte une definition Swagger/OpenAPI\n    \n        Cette API doit respecter le versioning indiqu\u00e9 dans l\u2019URL de la route API du Swagger. Dans un objectif de\n        simplification le versioning des routes n\u2019est pas affich\u00e9 dans le pr\u00e9sent document;\n        Dans cette API publi\u00e9e par le Fournisseur API ce dernier peut :\n        \u2022Avoir une URL sp\u00e9cifique en amont du versioning\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les requ\u00eates.\n        \u2022Ajouter des param\u00e8tres aux routes dans les requ\u00eates.\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les r\u00e9ponses.\n        \u2022Ajouter des codes erreurs dans les r\u00e9ponses.\n        &amp;quot;&amp;quot;&amp;quot;\n&amp;gt;       raise NotImplementedError(&amp;quot;swagger compliance non test\u00e9&amp;quot;)\nE       NotImplementedError: swagger compliance non test\u00e9\n\ntest_openapi.py:18: NotImplementedError\n&#34;}], &#34;test_openapi.py::test_swagger_directory_service&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_openapi.py::test_swagger_directory_service&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_openapi.py::test_swagger_directory_service&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;def test_swagger_directory_service():\n        url = &amp;quot;???&amp;quot;\n&amp;gt;       _test_swagger(\n            url,\n            &amp;quot;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE B - PR XP Z12-013 - AFNOR-Directory_Service-1.1.0-swagger.json&amp;quot;,\n        )\n\ntest_openapi.py:32: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nurl = &amp;#x27;???&amp;#x27;, swagger = &amp;#x27;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE B - PR XP Z12-013 - AFNOR-Directory_Service-1.1.0-swagger.json&amp;#x27;\n\n    def _test_swagger(url: str, swagger: str):\n        &amp;quot;&amp;quot;&amp;quot;\n            V\u00e9rifier si une API respecte une definition Swagger/OpenAPI\n    \n        Cette API doit respecter le versioning indiqu\u00e9 dans l\u2019URL de la route API du Swagger. Dans un objectif de\n        simplification le versioning des routes n\u2019est pas affich\u00e9 dans le pr\u00e9sent document;\n        Dans cette API publi\u00e9e par le Fournisseur API ce dernier peut :\n        \u2022Avoir une URL sp\u00e9cifique en amont du versioning\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les requ\u00eates.\n        \u2022Ajouter des param\u00e8tres aux routes dans les requ\u00eates.\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les r\u00e9ponses.\n        \u2022Ajouter des codes erreurs dans les r\u00e9ponses.\n        &amp;quot;&amp;quot;&amp;quot;\n&amp;gt;       raise NotImplementedError(&amp;quot;swagger compliance non test\u00e9&amp;quot;)\nE       NotImplementedError: swagger compliance non test\u00e9\n\ntest_openapi.py:18: NotImplementedError\n&#34;}], &#34;test_pac0.py::test_pac0_import_services&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_pac0.py::test_pac0_import_services&#34;, &#34;duration&#34;: &#34;201 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_pac0.py::test_pac0_import_services&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;201 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;+ Exception Group Traceback (most recent call last):\n  |   File &amp;quot;/home/philippe/src/PA_Communautaire/packages/pac-bdd/test_pac0.py&amp;quot;, line 21, in test_pac0_import_services\n  |     async with asyncio.TaskGroup() as tg:\n  |                ~~~~~~~~~~~~~~~~~^^\n  |   File &amp;quot;/home/philippe/.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/taskgroups.py&amp;quot;, line 71, in __aexit__\n  |     return await self._aexit(et, exc)\n  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  |   File &amp;quot;/home/philippe/.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/taskgroups.py&amp;quot;, line 173, in _aexit\n  |     raise BaseExceptionGroup(\n  |     ...&amp;lt;2 lines&amp;gt;...\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File &amp;quot;/home/philippe/src/PA_Communautaire/packages/pac-bdd/test_pac0.py&amp;quot;, line 22, in test_pac0_import_services\n    |     task1 = tg.create_task(api_gateway_main.app.run())\n    |                            ^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: &amp;#x27;FastAPI&amp;#x27; object has no attribute &amp;#x27;run&amp;#x27;\n    +------------------------------------\n\n------------------------------ Captured log setup ------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n\n----------------------------- Captured stdout call -----------------------------\nConnecting to NATS nats://localhost:4222 ...\nConnecting to NATS nats://localhost:4222 ...\nConnecting to NATS nats://localhost:4222 ...\n&#34;}], &#34;test_scenario.py::test_simpliste_avec_commentaire&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_simpliste_avec_commentaire&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_simpliste_avec_commentaire&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais quelque chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais quelque chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;ai fait 4 choses&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;ai fait {nb} choses&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_simpliste&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_simpliste&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_simpliste&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function it_works at 0x70f6b1e9c2c0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_simpliste&amp;gt;&amp;gt;, kwargs = {&amp;#x27;nb&amp;#x27;: &amp;#x27;4&amp;#x27;}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nnb = &amp;#x27;4&amp;#x27;\n\n    @then(parsers.parse(&amp;quot;&amp;quot;&amp;quot;j&amp;#x27;ai fait {nb} choses&amp;quot;&amp;quot;&amp;quot;))\n    def it_works(nb):\n        # si le nombre donn\u00e9e `nb` ne corresponds pas au contexte, on \u00e9choue\n&amp;gt;       assert ctx[&amp;#x27;nb&amp;#x27;] == int(nb)\n               ^^^^^^^^^^^^^^^^^^^^\nE       AssertionError\n\nsrc/pac_bdd/demo.py:31: AssertionError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais quelque chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais quelque chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;ai fait 4 choses&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;ai fait {nb} choses&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_trackingid_fourni&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_trackingid_fourni&#34;, &#34;duration&#34;: &#34;00:00:03&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_trackingid_fourni&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:03&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 13 in scenario &amp;quot;trackingId fourni&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/trackingId.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:9280/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8485 ...\n2026-01-15 10:07:39,185 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:07:39,186 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8485 ...\n2026-01-15 10:07:39,196 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:07:39,196 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8485 ...\n2026-01-15 10:07:39,214 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:07:39,214 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8485 ...\n2026-01-15 10:07:39,227 INFO     - q | routage-IN  |            - `Process` waiting for messages\nConnecting to NATS nats://localhost:8485 ...\n2026-01-15 10:07:39,227 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:07:39,227 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:07:39,227 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:07:39,228 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:39,228 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:39,228 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:39,229 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:39,229 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:07:39,229 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:39,229 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:39,230 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:07:39,230 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:07:39,230 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:39,231 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:39,231 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:07:39,231 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8485 ...\n2026-01-15 10:07:39,233 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:07:39,234 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8485 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:9280\n    server   Documentation at http://0.0.0.0:9280/docs\n \n             Logs:\n \n2026-01-15 10:07:39,351 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:07:39,352 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:07:39,352 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:07:39,353 INFO     - *                | 6083b93d-2 - Received\n2026-01-15 10:07:39,356 INFO     - *                | 6083b93d-2 - Processed\n_check_http_health http://localhost:9280/healthcheck\n      INFO   127.0.0.1:53414 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:53430 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[29867] 2026/01/15 10:07:38.802074 [INF] Starting nats-server\n[29867] 2026/01/15 10:07:38.802132 [INF]   Version:  2.12.3\n[29867] 2026/01/15 10:07:38.802135 [INF]   Git:      [450a519]\n[29867] 2026/01/15 10:07:38.802138 [INF]   Name:     ND2A75IRUVQKZM3XPSFJVAHIAEDW4GPYJU55OLGKASU5FOKDFC6MFFAO\n[29867] 2026/01/15 10:07:38.802144 [INF]   ID:       ND2A75IRUVQKZM3XPSFJVAHIAEDW4GPYJU55OLGKASU5FOKDFC6MFFAO\n[29867] 2026/01/15 10:07:38.802643 [INF] Listening for client connections on 0.0.0.0:8485\n[29867] 2026/01/15 10:07:38.802913 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:07:39,181 INFO     - FastStream app starting...\n2026-01-15 10:07:39,186 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:39,193 INFO     - FastStream app starting...\n2026-01-15 10:07:39,196 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:39,210 INFO     - FastStream app starting...\n2026-01-15 10:07:39,214 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:39,224 INFO     - FastStream app starting...\n2026-01-15 10:07:39,224 INFO     - FastStream app starting...\n2026-01-15 10:07:39,227 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:39,231 INFO     - FastStream app starting...\n2026-01-15 10:07:39,231 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:39,234 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [29882]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:9280 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8623 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:8623\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8485 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:8485\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 9280 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8690 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:8690\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 8765 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:8765\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 8745 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:8745\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 8301 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:8301\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8695 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:8695\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 9271 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:9271\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 8753 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:8753\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9280 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9280 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x70f6b12b5e80&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:39 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:9280/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:9280\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9280 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x70f6b12b7770&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:39 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:9280/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [29882]\n2026-01-15 10:07:40,285 INFO     - FastStream app shutting down...\n2026-01-15 10:07:40,287 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:40,498 INFO     - FastStream app shutting down...\n2026-01-15 10:07:40,499 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:40,718 INFO     - FastStream app shutting down...\n2026-01-15 10:07:40,719 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:40,929 INFO     - FastStream app shutting down...\n2026-01-15 10:07:40,930 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:41,138 INFO     - FastStream app shutting down...\n2026-01-15 10:07:41,140 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:41,330 INFO     - FastStream app shutting down...\n2026-01-15 10:07:41,331 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_trackingid_absent&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_trackingid_absent&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_trackingid_absent&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 23 in scenario &amp;quot;trackingId absent&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/trackingId.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:9139/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8412 ...\n2026-01-15 10:07:42,068 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:07:42,069 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8412 ...\n2026-01-15 10:07:42,075 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:07:42,076 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8412 ...\n2026-01-15 10:07:42,093 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:07:42,094 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8412 ...\n2026-01-15 10:07:42,106 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-15 10:07:42,106 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8412 ...\n2026-01-15 10:07:42,117 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:07:42,118 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8412 ...\n2026-01-15 10:07:42,134 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:07:42,135 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:07:42,136 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:42,136 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:42,136 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:42,137 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:42,137 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:07:42,137 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:42,138 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:42,138 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:07:42,139 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:07:42,139 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:42,139 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:42,140 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:07:42,140 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8412 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:9139\n    server   Documentation at http://0.0.0.0:9139/docs\n \n             Logs:\n \n2026-01-15 10:07:42,298 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:07:42,300 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:07:42,300 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:07:42,301 INFO     - *                | 2f63a314-9 - Received\n2026-01-15 10:07:42,305 INFO     - *                | 2f63a314-9 - Processed\n_check_http_health http://localhost:9139/healthcheck\n      INFO   127.0.0.1:51218 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:51226 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[29951] 2026/01/15 10:07:41.500645 [INF] Starting nats-server\n[29951] 2026/01/15 10:07:41.500702 [INF]   Version:  2.12.3\n[29951] 2026/01/15 10:07:41.500707 [INF]   Git:      [450a519]\n[29951] 2026/01/15 10:07:41.500711 [INF]   Name:     NCBB3B74CWNUAMVIE6HSSO2JZ4L3RL56FNGMRCK5NVY67JCUYW4J2DZR\n[29951] 2026/01/15 10:07:41.500715 [INF]   ID:       NCBB3B74CWNUAMVIE6HSSO2JZ4L3RL56FNGMRCK5NVY67JCUYW4J2DZR\n[29951] 2026/01/15 10:07:41.501288 [INF] Listening for client connections on 0.0.0.0:8412\n[29951] 2026/01/15 10:07:41.501693 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:07:42,064 INFO     - FastStream app starting...\n2026-01-15 10:07:42,069 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:42,072 INFO     - FastStream app starting...\n2026-01-15 10:07:42,076 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:42,090 INFO     - FastStream app starting...\n2026-01-15 10:07:42,094 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:42,102 INFO     - FastStream app starting...\n2026-01-15 10:07:42,106 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:42,114 INFO     - FastStream app starting...\n2026-01-15 10:07:42,118 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:42,131 INFO     - FastStream app starting...\n2026-01-15 10:07:42,140 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [29968]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:9139 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8556 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:8556\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8412 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:8412\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 9139 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8305 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:8305\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 8360 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:8360\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 9031 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:9031\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 8367 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:8367\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8761 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:8761\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 9001 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:9001\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 8827 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:8827\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9139 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9139 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x70f6b12d2710&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:42 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:9139/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:9139\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9139 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x70f6b12d3c50&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:42 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:9139/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [29968]\n2026-01-15 10:07:42,868 INFO     - FastStream app shutting down...\n2026-01-15 10:07:42,869 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:43,076 INFO     - FastStream app shutting down...\n2026-01-15 10:07:43,077 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:43,294 INFO     - FastStream app shutting down...\n2026-01-15 10:07:43,296 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:43,507 INFO     - FastStream app shutting down...\n2026-01-15 10:07:43,509 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:43,618 INFO     - FastStream app shutting down...\n2026-01-15 10:07:43,620 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:43,736 INFO     - FastStream app shutting down...\n2026-01-15 10:07:43,737 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_trackingid_doublon&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_trackingid_doublon&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_trackingid_doublon&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 32 in scenario &amp;quot;trackingId doublon&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/trackingId.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:8616/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8385 ...\n2026-01-15 10:07:44,470 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:07:44,471 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8385 ...\n2026-01-15 10:07:44,481 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:07:44,481 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8385 ...\n2026-01-15 10:07:44,498 INFO     - q | routage-IN  |            - `Process` waiting for messages\nConnecting to NATS nats://localhost:8385 ...\n2026-01-15 10:07:44,498 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:07:44,499 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:07:44,499 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8385 ...\n2026-01-15 10:07:44,509 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:07:44,509 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8385 ...\n2026-01-15 10:07:44,525 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:07:44,525 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:07:44,526 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:44,526 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:44,527 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:44,527 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:44,527 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:07:44,528 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:44,528 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:44,528 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:07:44,529 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:07:44,529 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:44,530 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:44,530 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:07:44,530 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8385 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8616\n    server   Documentation at http://0.0.0.0:8616/docs\n \n             Logs:\n \n2026-01-15 10:07:44,690 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:07:44,692 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:07:44,692 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:07:44,693 INFO     - *                | fd3ae63a-5 - Received\n2026-01-15 10:07:44,696 INFO     - *                | fd3ae63a-5 - Processed\n_check_http_health http://localhost:8616/healthcheck\n      INFO   127.0.0.1:53914 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:53930 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[30038] 2026/01/15 10:07:43.904099 [INF] Starting nats-server\n[30038] 2026/01/15 10:07:43.904199 [INF]   Version:  2.12.3\n[30038] 2026/01/15 10:07:43.904206 [INF]   Git:      [450a519]\n[30038] 2026/01/15 10:07:43.904211 [INF]   Name:     NAIM3O4A44Y4LKN3F2ETN5G55HWOBHERWRZWNGPMY7LVQEAGL5AH7OAG\n[30038] 2026/01/15 10:07:43.904220 [INF]   ID:       NAIM3O4A44Y4LKN3F2ETN5G55HWOBHERWRZWNGPMY7LVQEAGL5AH7OAG\n[30038] 2026/01/15 10:07:43.904939 [INF] Listening for client connections on 0.0.0.0:8385\n[30038] 2026/01/15 10:07:43.905339 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:07:44,466 INFO     - FastStream app starting...\n2026-01-15 10:07:44,471 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:44,477 INFO     - FastStream app starting...\n2026-01-15 10:07:44,482 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:44,494 INFO     - FastStream app starting...\n2026-01-15 10:07:44,494 INFO     - FastStream app starting...\n2026-01-15 10:07:44,499 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:44,499 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:44,505 INFO     - FastStream app starting...\n2026-01-15 10:07:44,509 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:44,521 INFO     - FastStream app starting...\n2026-01-15 10:07:44,530 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [30054]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8616 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8347 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:8347\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8385 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:8385\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8616 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8749 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:8749\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 9250 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:9250\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 8458 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:8458\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 8540 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:8540\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 9215 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:9215\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 8958 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:8958\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 8490 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:8490\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8616 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8616 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x70f6b12d39d0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:44 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8616/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:8616\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8616 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x70f6b12d2d50&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:44 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8616/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [30054]\n2026-01-15 10:07:45,280 INFO     - FastStream app shutting down...\n2026-01-15 10:07:45,282 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:45,498 INFO     - FastStream app shutting down...\n2026-01-15 10:07:45,499 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:45,671 INFO     - FastStream app shutting down...\n2026-01-15 10:07:45,673 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:45,797 INFO     - FastStream app shutting down...\n2026-01-15 10:07:45,798 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:46,008 INFO     - FastStream app shutting down...\n2026-01-15 10:07:46,009 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:46,126 INFO     - FastStream app shutting down...\n2026-01-15 10:07:46,128 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_api_gateway&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_api_gateway&#34;, &#34;duration&#34;: &#34;00:00:01&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marragearr\u00eat_service_api_gateway&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:01&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:8432/healthcheck\ncccccc All connection attempts failed\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8950 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8432\n    server   Documentation at http://0.0.0.0:8432/docs\n \n             Logs:\n \n2026-01-15 10:07:47,040 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:07:47,042 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:07:47,042 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:07:47,044 INFO     - *                | 2bf0edbc-a - Received\n2026-01-15 10:07:47,047 INFO     - *                | 2bf0edbc-a - Processed\n_check_http_health http://localhost:8432/healthcheck\n      INFO   127.0.0.1:42328 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[30121] 2026/01/15 10:07:46.254216 [INF] Starting nats-server\n[30121] 2026/01/15 10:07:46.254313 [INF]   Version:  2.12.3\n[30121] 2026/01/15 10:07:46.254318 [INF]   Git:      [450a519]\n[30121] 2026/01/15 10:07:46.254322 [INF]   Name:     NBMADNQG332ZXZKUJPD46XAIJGSKQ7DME4SVWHDWUISEM445UVL3IZND\n[30121] 2026/01/15 10:07:46.254335 [INF]   ID:       NBMADNQG332ZXZKUJPD46XAIJGSKQ7DME4SVWHDWUISEM445UVL3IZND\n[30121] 2026/01/15 10:07:46.254987 [INF] Listening for client connections on 0.0.0.0:8950\n[30121] 2026/01/15 10:07:46.255401 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n      INFO   Started server process [30134]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8432 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service None on port 8950 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready None ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  None started on localhost:8950\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;01-api-gateway&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;01-api-gateway&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je lance le service &amp;quot;01-api-gateway&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je lance le service &amp;quot;01-api-gateway&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8432 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8432 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8432 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x70f6b12ceb10&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:47 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8432/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:8432\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;01-api-gateway&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;01-api-gateway&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [30134]\n[30121] 2026/01/15 10:07:47.490167 [INF] Trapped &amp;quot;terminated&amp;quot; signal\n[30121] 2026/01/15 10:07:47.490439 [INF] Initiating Shutdown...\n[30121] 2026/01/15 10:07:47.490568 [INF] Server Exiting..\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...&#34;}], &#34;test_scenario.py::test_contr\u00f4le_sha256&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_contr\u00f4le_sha256&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_contr\u00f4le_sha256&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 9 in scenario &amp;quot;Contr\u00f4le sha256&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/sha256.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:9181/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8544 ...\n2026-01-15 10:07:48,054 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:07:48,055 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8544 ...\n2026-01-15 10:07:48,070 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:07:48,071 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8544 ...\n2026-01-15 10:07:48,072 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:07:48,073 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8544 ...\n2026-01-15 10:07:48,102 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:07:48,103 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8544 ...\n2026-01-15 10:07:48,104 INFO     - q | routage-IN  |            - `Process` waiting for messages\nConnecting to NATS nats://localhost:8544 ...\n2026-01-15 10:07:48,104 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:07:48,105 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:07:48,105 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:07:48,106 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:48,106 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:48,107 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:48,107 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:48,107 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:07:48,108 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:48,108 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:48,108 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:07:48,109 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:07:48,109 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:48,110 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:48,110 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:07:48,110 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8544 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:9181\n    server   Documentation at http://0.0.0.0:9181/docs\n \n             Logs:\n \n2026-01-15 10:07:48,287 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:07:48,288 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:07:48,289 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:07:48,290 INFO     - *                | a058d10c-7 - Received\n2026-01-15 10:07:48,293 INFO     - *                | a058d10c-7 - Processed\n_check_http_health http://localhost:9181/healthcheck\n      INFO   127.0.0.1:53560 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:53566 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[30143] 2026/01/15 10:07:47.509321 [INF] Starting nats-server\n[30143] 2026/01/15 10:07:47.509432 [INF]   Version:  2.12.3\n[30143] 2026/01/15 10:07:47.509439 [INF]   Git:      [450a519]\n[30143] 2026/01/15 10:07:47.509443 [INF]   Name:     NA4WC6RTOK3B4FEH5YFUFEAKDVS46VQPBGU7XIAKZGQYBBK7D3JIY2BM\n[30143] 2026/01/15 10:07:47.509447 [INF]   ID:       NA4WC6RTOK3B4FEH5YFUFEAKDVS46VQPBGU7XIAKZGQYBBK7D3JIY2BM\n[30143] 2026/01/15 10:07:47.510254 [INF] Listening for client connections on 0.0.0.0:8544\n[30143] 2026/01/15 10:07:47.510698 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:07:48,050 INFO     - FastStream app starting...\n2026-01-15 10:07:48,055 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:48,066 INFO     - FastStream app starting...\n2026-01-15 10:07:48,069 INFO     - FastStream app starting...\n2026-01-15 10:07:48,071 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:48,073 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:48,098 INFO     - FastStream app starting...\n2026-01-15 10:07:48,100 INFO     - FastStream app starting...\n2026-01-15 10:07:48,101 INFO     - FastStream app starting...\n2026-01-15 10:07:48,103 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:48,105 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:48,110 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [30164]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:9181 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 9073 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:9073\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8544 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:8544\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 9181 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8844 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:8844\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 9149 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:9149\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 9093 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:9093\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 8877 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:8877\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8781 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:8781\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 8500 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:8500\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 9176 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:9176\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9181 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9181 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x70f6b12cc9d0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:48 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:9181/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:9181\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9181 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x70f6b13dcb00&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:48 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:9181/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [30164]\n2026-01-15 10:07:48,853 INFO     - FastStream app shutting down...\n2026-01-15 10:07:48,855 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:48,969 INFO     - FastStream app shutting down...\n2026-01-15 10:07:48,970 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:49,203 INFO     - FastStream app shutting down...\n2026-01-15 10:07:49,204 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:49,405 INFO     - FastStream app shutting down...\n2026-01-15 10:07:49,406 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:49,573 INFO     - FastStream app shutting down...\n2026-01-15 10:07:49,575 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:49,806 INFO     - FastStream app shutting down...\n2026-01-15 10:07:49,808 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_healthcheck&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_healthcheck&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_healthcheck&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:9067/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8368 ...\n2026-01-15 10:07:50,495 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:07:50,495 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8368 ...\n2026-01-15 10:07:50,513 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:07:50,513 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8368 ...\n2026-01-15 10:07:50,516 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-15 10:07:50,516 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8368 ...\n2026-01-15 10:07:50,517 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:07:50,517 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8368 ...\n2026-01-15 10:07:50,535 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:07:50,535 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8368 ...\n2026-01-15 10:07:50,552 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:07:50,553 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:07:50,553 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:50,554 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:50,554 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:50,555 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:50,555 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:07:50,555 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:50,556 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:50,556 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:07:50,557 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:07:50,557 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:50,557 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:50,558 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:07:50,558 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8368 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:9067\n    server   Documentation at http://0.0.0.0:9067/docs\n \n             Logs:\n \n2026-01-15 10:07:50,740 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:07:50,741 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:07:50,742 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:07:50,743 INFO     - *                | 5ba7b203-f - Received\n2026-01-15 10:07:50,746 INFO     - *                | 5ba7b203-f - Processed\n_check_http_health http://localhost:9067/healthcheck\n      INFO   127.0.0.1:44654 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:44660 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[30227] 2026/01/15 10:07:49.947541 [INF] Starting nats-server\n[30227] 2026/01/15 10:07:49.947659 [INF]   Version:  2.12.3\n[30227] 2026/01/15 10:07:49.947672 [INF]   Git:      [450a519]\n[30227] 2026/01/15 10:07:49.947676 [INF]   Name:     NBZDWIEO6CTGCGX7FVEYSQTPQYUCXIZVJQO35ERUBXMXJ3GXVO635RAF\n[30227] 2026/01/15 10:07:49.947689 [INF]   ID:       NBZDWIEO6CTGCGX7FVEYSQTPQYUCXIZVJQO35ERUBXMXJ3GXVO635RAF\n[30227] 2026/01/15 10:07:49.948537 [INF] Listening for client connections on 0.0.0.0:8368\n[30227] 2026/01/15 10:07:49.948988 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:07:50,491 INFO     - FastStream app starting...\n2026-01-15 10:07:50,495 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:50,509 INFO     - FastStream app starting...\n2026-01-15 10:07:50,512 INFO     - FastStream app starting...\n2026-01-15 10:07:50,513 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:50,514 INFO     - FastStream app starting...\n2026-01-15 10:07:50,516 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:50,518 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:50,531 INFO     - FastStream app starting...\n2026-01-15 10:07:50,535 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:50,549 INFO     - FastStream app starting...\n2026-01-15 10:07:50,558 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [30248]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:9067 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_une pa communautaire&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_une pa communautaire&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 9253 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:9253\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8368 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:8368\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 9067 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8970 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:8970\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 8375 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:8375\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 8967 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:8967\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 8424 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:8424\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 9011 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:9011\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 9041 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:9041\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 9051 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:9051\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9067 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9067 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x70f6b12e6c30&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:50 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:9067/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:9067\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API GET /healthcheck&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9067 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x70f6b13de650&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:50 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:9067/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;obtiens le code de retour 200&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;obtiens le code de retour {code}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [30248]\n2026-01-15 10:07:51,293 INFO     - FastStream app shutting down...\n2026-01-15 10:07:51,294 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:51,517 INFO     - FastStream app shutting down...\n2026-01-15 10:07:51,518 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:51,713 INFO     - FastStream app shutting down...\n2026-01-15 10:07:51,714 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:51,916 INFO     - FastStream app shutting down...\n2026-01-15 10:07:51,918 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:52,135 INFO     - FastStream app shutting down...\n2026-01-15 10:07:52,136 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:52,253 INFO     - FastStream app shutting down...\n2026-01-15 10:07:52,254 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_healthcheck_deep&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_healthcheck_deep&#34;, &#34;duration&#34;: &#34;00:00:05&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_healthcheck_deep&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:05&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:9120/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8473 ...\n2026-01-15 10:07:52,937 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:07:52,938 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8473 ...\n2026-01-15 10:07:52,940 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:07:52,940 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8473 ...\n2026-01-15 10:07:52,949 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-15 10:07:52,950 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8473 ...\n2026-01-15 10:07:52,969 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:07:52,969 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8473 ...\n2026-01-15 10:07:52,971 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:07:52,971 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8473 ...\n2026-01-15 10:07:52,971 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:07:52,972 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:07:52,973 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:52,973 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:52,973 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:52,974 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:52,974 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:07:52,975 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:52,975 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:52,975 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:07:52,976 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:07:52,976 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:52,977 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:52,977 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:07:52,977 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8473 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:9120\n    server   Documentation at http://0.0.0.0:9120/docs\n \n             Logs:\n \n2026-01-15 10:07:53,152 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:07:53,154 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:07:53,154 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:07:53,156 INFO     - *                | 3529507e-0 - Received\n2026-01-15 10:07:53,159 INFO     - *                | 3529507e-0 - Processed\n_check_http_health http://localhost:9120/healthcheck\n      INFO   127.0.0.1:54754 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n2026-01-15 10:07:53,541 INFO     -   | healthcheck          | 1348863f-f - Received\n2026-01-15 10:07:53,541 INFO     -   | healthcheck             | 1348863f-f - Received\n2026-01-15 10:07:53,541 INFO     - healthcheck      | 1348863f-f - Received\n2026-01-15 10:07:53,541 INFO     -   | healthcheck | 1348863f-f - Received\n2026-01-15 10:07:53,541 INFO     -   | healthcheck           | 1348863f-f - Received\n2026-01-15 10:07:53,541 INFO     -   | healthcheck         | 1348863f-f - Received\n2026-01-15 10:07:53,541 INFO     -   | healthcheck              | 1348863f-f - Received\n2026-01-15 10:07:53,541 INFO     -   | healthcheck          | 1348863f-f - Processed\n2026-01-15 10:07:53,542 INFO     - healthcheck      | 1348863f-f - Processed\n2026-01-15 10:07:53,542 INFO     -   | healthcheck             | 1348863f-f - Processed\n2026-01-15 10:07:53,542 INFO     -   | healthcheck | 1348863f-f - Processed\n2026-01-15 10:07:53,542 INFO     -   | healthcheck           | 1348863f-f - Processed\n2026-01-15 10:07:53,542 INFO     - *                | 1348863f-f - Received\n2026-01-15 10:07:53,542 INFO     -   | healthcheck              | 1348863f-f - Processed\n2026-01-15 10:07:53,542 INFO     -   | healthcheck         | 1348863f-f - Processed\n2026-01-15 10:07:53,543 INFO     - healthcheck_resp | bd0d9d74-6 - Received\n2026-01-15 10:07:53,543 INFO     - healthcheck_resp | bd0d9d74-6 - Processed\n2026-01-15 10:07:53,543 INFO     - healthcheck_resp | dac674f8-5 - Received\n2026-01-15 10:07:53,544 INFO     - healthcheck_resp | dac674f8-5 - Processed\n2026-01-15 10:07:53,544 INFO     - healthcheck_resp | 1e5dbfe5-9 - Received\n2026-01-15 10:07:53,545 INFO     - healthcheck_resp | 1e5dbfe5-9 - Processed\n2026-01-15 10:07:53,545 INFO     - healthcheck_resp | 700cdbdb-0 - Received\n2026-01-15 10:07:53,545 INFO     - healthcheck_resp | 700cdbdb-0 - Processed\n2026-01-15 10:07:53,545 INFO     - healthcheck_resp | 15562ff6-b - Received\n2026-01-15 10:07:53,545 INFO     - healthcheck_resp | 15562ff6-b - Processed\n2026-01-15 10:07:53,545 INFO     - healthcheck_resp | a07e15c6-8 - Received\n2026-01-15 10:07:53,545 INFO     - healthcheck_resp | a07e15c6-8 - Processed\n2026-01-15 10:07:53,545 INFO     - *                | 1348863f-f - Processed\n2026-01-15 10:07:53,546 INFO     - *                | bd0d9d74-6 - Received\n2026-01-15 10:07:53,546 INFO     - healthcheck_resp | 4120447b-4 - Received\n2026-01-15 10:07:53,546 INFO     - healthcheck_resp | 4120447b-4 - Processed\n2026-01-15 10:07:53,546 INFO     - *                | bd0d9d74-6 - Processed\n2026-01-15 10:07:53,546 INFO     - *                | dac674f8-5 - Received\n2026-01-15 10:07:53,547 INFO     - *                | dac674f8-5 - Processed\n2026-01-15 10:07:53,547 INFO     - *                | 1e5dbfe5-9 - Received\n2026-01-15 10:07:53,547 INFO     - *                | 1e5dbfe5-9 - Processed\n2026-01-15 10:07:53,547 INFO     - *                | 700cdbdb-0 - Received\n2026-01-15 10:07:53,547 INFO     - *                | 700cdbdb-0 - Processed\n2026-01-15 10:07:53,548 INFO     - *                | 15562ff6-b - Received\n2026-01-15 10:07:53,548 INFO     - *                | 15562ff6-b - Processed\n2026-01-15 10:07:53,548 INFO     - *                | a07e15c6-8 - Received\n2026-01-15 10:07:53,548 INFO     - *                | a07e15c6-8 - Processed\n2026-01-15 10:07:53,548 INFO     - *                | 4120447b-4 - Received\n2026-01-15 10:07:53,549 INFO     - *                | 4120447b-4 - Processed\n      INFO   127.0.0.1:54760 - &amp;quot;GET /healthcheck/deep HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[30310] 2026/01/15 10:07:52.375936 [INF] Starting nats-server\n[30310] 2026/01/15 10:07:52.376033 [INF]   Version:  2.12.3\n[30310] 2026/01/15 10:07:52.376038 [INF]   Git:      [450a519]\n[30310] 2026/01/15 10:07:52.376042 [INF]   Name:     ND6DTQ33ETB5JD52BEUEOPSESYKAA2IS56PJ7TZ6LIPHOXNG3NYLXP7O\n[30310] 2026/01/15 10:07:52.376052 [INF]   ID:       ND6DTQ33ETB5JD52BEUEOPSESYKAA2IS56PJ7TZ6LIPHOXNG3NYLXP7O\n[30310] 2026/01/15 10:07:52.376734 [INF] Listening for client connections on 0.0.0.0:8473\n[30310] 2026/01/15 10:07:52.377135 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:07:52,933 INFO     - FastStream app starting...\n2026-01-15 10:07:52,936 INFO     - FastStream app starting...\n2026-01-15 10:07:52,938 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:52,940 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:52,946 INFO     - FastStream app starting...\n2026-01-15 10:07:52,950 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:52,964 INFO     - FastStream app starting...\n2026-01-15 10:07:52,967 INFO     - FastStream app starting...\n2026-01-15 10:07:52,968 INFO     - FastStream app starting...\n2026-01-15 10:07:52,969 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:52,971 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:52,977 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [30326]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:9120 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_une pa communautaire&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_une pa communautaire&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8454 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:8454\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8473 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:8473\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 9120 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8333 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:8333\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 8483 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:8483\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 8378 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:8378\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 8568 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:8568\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8764 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:8764\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 8727 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:8727\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 9094 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:9094\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9120 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9120 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x70f6b120fce0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:53 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:9120/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:9120\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API GET /healthcheck/deep&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9120 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x70f6b12e6330&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:53 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;84&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:9120/healthcheck/deep &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;obtiens le code de retour 200&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;obtiens le code de retour {code}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_la r\u00e9ponse a une cl\u00e9 &amp;quot;healthcheck_resp&amp;quot; avec 7 \u00e9l\u00e9ments&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_la r\u00e9ponse a une cl\u00e9 &amp;quot;{key}&amp;quot; avec {nb} \u00e9l\u00e9ments&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [30326]\n2026-01-15 10:07:55,747 INFO     - FastStream app shutting down...\n2026-01-15 10:07:55,748 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:55,977 INFO     - FastStream app shutting down...\n2026-01-15 10:07:55,978 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:56,148 INFO     - FastStream app shutting down...\n2026-01-15 10:07:56,149 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:56,359 INFO     - FastStream app shutting down...\n2026-01-15 10:07:56,360 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:56,578 INFO     - FastStream app shutting down...\n2026-01-15 10:07:56,579 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:56,779 INFO     - FastStream app shutting down...\n2026-01-15 10:07:56,781 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_controle_formats&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_controle_formats&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marragearr\u00eat_service_controle_formats&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;le service &amp;quot;03-controle-formats&amp;quot; n&amp;#x27;est pas pr\u00eat&amp;quot;. Line 6 in scenario &amp;quot;d\u00e9marrage/arr\u00eat service controle formats&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/03-controle-formats/service.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_controle_format_facturx&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_controle_format_facturx&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_controle_format_facturx&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function control_invoice at 0x70f6b1d107c0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_controle_format_facturx&amp;gt;&amp;gt;, kwargs = {}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @when(\n        parsers.parse(&amp;quot;je d\u00e9pose pour contr\u00f4le la facture @{invoice}&amp;quot;),\n    )\n    def control_invoice():\n&amp;gt;       raise NotImplementedError()\nE       NotImplementedError\n\nsrc/pac_bdd/tobeimplemented.py:30: NotImplementedError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je d\u00e9pose pour contr\u00f4le la facture @FA213746_20251211_124749.pdf&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je d\u00e9pose pour contr\u00f4le la facture @{invoice}&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_serveur_nats&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_serveur_nats&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_serveur_nats&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un serveur NATS disponible&amp;quot;. Line 19 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un serveur NATS&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/service_lifecycle.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_connexion_dun_broker_au_serveur_nats&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_connexion_dun_broker_au_serveur_nats&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_connexion_dun_broker_au_serveur_nats&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un serveur NATS disponible&amp;quot;. Line 23 in scenario &amp;quot;Connexion d&amp;#x27;un broker au serveur NATS&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/service_lifecycle.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_de_plusieurs_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_de_plusieurs_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_de_plusieurs_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;2 PA d\u00e9marr\u00e9es&amp;quot;. Line 32 in scenario &amp;quot;D\u00e9marrage de plusieurs PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/service_lifecycle.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_service_nats_local&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_service_nats_local&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_service_nats_local&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service NATS local&amp;quot;. Line 21 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un service NATS local&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_connexion_\u00e0_un_service_nats_distant&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_connexion_\u00e0_un_service_nats_distant&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_connexion_\u00e0_un_service_nats_distant&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service NATS local comme r\u00e9f\u00e9rence&amp;quot;. Line 27 in scenario &amp;quot;Connexion \u00e0 un service NATS distant&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_service_peppol_mock&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_service_peppol_mock&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_service_peppol_mock&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock&amp;quot;. Line 33 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un service Peppol mock&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_configuration_des_r\u00e9ponses_peppol_mock&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_configuration_des_r\u00e9ponses_peppol_mock&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_configuration_des_r\u00e9ponses_peppol_mock&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock&amp;quot;. Line 38 in scenario &amp;quot;Configuration des r\u00e9ponses Peppol mock&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_recherche_peppol_dune_entreprise_non_enregistr\u00e9e&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_recherche_peppol_dune_entreprise_non_enregistr\u00e9e&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_recherche_peppol_dune_entreprise_non_enregistr\u00e9e&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock&amp;quot;. Line 45 in scenario &amp;quot;Recherche Peppol d&amp;#x27;une entreprise non enregistr\u00e9e&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_service_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_service_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_service_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service PA&amp;quot;. Line 51 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un service PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_1_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_1_pa&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_1_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 1 PA&amp;quot;. Line 61 in scenario &amp;quot;Cr\u00e9ation d&amp;#x27;un monde avec 1 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_2_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_2_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_2_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 68 in scenario &amp;quot;Cr\u00e9ation d&amp;#x27;un monde avec 2 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_4_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_4_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_4_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 4 PA&amp;quot;. Line 74 in scenario &amp;quot;Cr\u00e9ation d&amp;#x27;un monde avec 4 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_les_pa_partagent_le_m\u00eame_service_nats&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_les_pa_partagent_le_m\u00eame_service_nats&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_les_pa_partagent_le_m\u00eame_service_nats&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 82 in scenario &amp;quot;Les PA partagent le m\u00eame service NATS&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_les_pa_ont_des_ports_api_distincts&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_les_pa_ont_des_ports_api_distincts&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_les_pa_ont_des_ports_api_distincts&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 3 PA&amp;quot;. Line 87 in scenario &amp;quot;Les PA ont des ports API distincts&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_toutes_les_pa_r\u00e9pondent_au_healthcheck&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_toutes_les_pa_r\u00e9pondent_au_healthcheck&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_toutes_les_pa_r\u00e9pondent_au_healthcheck&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 95 in scenario &amp;quot;Toutes les PA r\u00e9pondent au healthcheck&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_information_du_monde&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_information_du_monde&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_information_du_monde&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 104 in scenario &amp;quot;Information du monde&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_arr\u00eat_propre_du_monde&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_arr\u00eat_propre_du_monde&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_arr\u00eat_propre_du_monde&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA d\u00e9marr\u00e9&amp;quot;. Line 115 in scenario &amp;quot;Arr\u00eat propre du monde&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_monde_avec_nats_externe&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_monde_avec_nats_externe&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_monde_avec_nats_externe&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service NATS local comme r\u00e9f\u00e9rence&amp;quot;. Line 126 in scenario &amp;quot;Monde avec NATS externe&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_monde_avec_peppol_personnalis\u00e9&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_monde_avec_peppol_personnalis\u00e9&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_monde_avec_peppol_personnalis\u00e9&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock comme r\u00e9f\u00e9rence&amp;quot;. Line 132 in scenario &amp;quot;Monde avec Peppol personnalis\u00e9&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9p\u00f4t_de_facture_entre_2_pa_via_peppol&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9p\u00f4t_de_facture_entre_2_pa_via_peppol&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9p\u00f4t_de_facture_entre_2_pa_via_peppol&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 141 in scenario &amp;quot;D\u00e9p\u00f4t de facture entre 2 PA via Peppol&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_esb_central&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_esb_central&#34;, &#34;duration&#34;: &#34;5 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marragearr\u00eat_service_esb_central&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;5 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_le service &amp;quot;02-esb-central&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_le service &amp;quot;02-esb-central&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service None on port 8302 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready None ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  None started on localhost:8302\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...&#34;}], &#34;test_scenario.py::test_healthcheck_message&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_healthcheck_message&#34;, &#34;duration&#34;: &#34;00:00:03&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_healthcheck_message&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:03&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function esb_sub_msg2 at 0x70f6b1e9cae0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_healthcheck_message&amp;gt;&amp;gt;, kwargs = {&amp;#x27;canal&amp;#x27;: &amp;#x27;healthcheck_resp&amp;#x27;, &amp;#x27;msg&amp;#x27;: &amp;#x27;toto&amp;#x27;, &amp;#x27;world1&amp;#x27;: WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceCon...tream.FastStreamServiceContext object at 0x70f6b12bd390&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x70f6b128e150&amp;gt;)])}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nworld1 = WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x70f6b1311040&amp;gt;, pas=[PacServiceContext(...stream.FastStreamServiceContext object at 0x70f6b12bd390&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x70f6b128e150&amp;gt;)]), msg = &amp;#x27;toto&amp;#x27;, canal = &amp;#x27;healthcheck_resp&amp;#x27;\n\n    @then(parsers.parse(&amp;quot;&amp;quot;&amp;quot;j&amp;#x27;obtiens le message &amp;#x27;{msg}&amp;#x27; sur le canal &amp;#x27;{canal}&amp;#x27;&amp;quot;&amp;quot;&amp;quot;))\n    def esb_sub_msg2(\n        world1: WorldContext,\n        msg: str,\n        canal: str,\n    ):\n        traces = []\n        with world1.pa1.api_gateway.get_client() as client:\n            response = client.get(&amp;quot;/trace&amp;quot;)\n            assert response.status_code == 200\n            traces = response.json()\n    \n        for trace in traces:\n            print(trace)\n            if trace[&amp;quot;subject&amp;quot;] == canal and trace[&amp;quot;body&amp;quot;] == msg:\n                return\n        else:\n&amp;gt;           raise Exception(&amp;quot;message not found !&amp;quot;)\nE           Exception: message not found !\n\nsrc/pac_bdd/esb.py:78: Exception\n\n----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:8404/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8949 ...\n2026-01-15 10:07:57,570 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:07:57,571 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8949 ...\n2026-01-15 10:07:57,585 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:07:57,586 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8949 ...\n2026-01-15 10:07:57,589 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:07:57,590 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8949 ...\n2026-01-15 10:07:57,606 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:07:57,606 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8949 ...\n2026-01-15 10:07:57,619 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:07:57,620 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:07:57,621 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:57,621 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:57,622 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:57,622 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:57,622 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:07:57,623 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:57,623 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:57,623 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:07:57,624 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:07:57,624 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:57,625 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:07:57,625 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:07:57,625 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8949 ...\n2026-01-15 10:07:57,630 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-15 10:07:57,630 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8949 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8404\n    server   Documentation at http://0.0.0.0:8404/docs\n \n             Logs:\n \n2026-01-15 10:07:57,799 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:07:57,800 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:07:57,801 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:07:57,802 INFO     - *                | 430b9fa3-e - Received\n2026-01-15 10:07:57,805 INFO     - *                | 430b9fa3-e - Processed\n_check_http_health http://localhost:8404/healthcheck\n      INFO   127.0.0.1:53774 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:53778 - &amp;quot;POST /publish HTTP/1.1&amp;quot; 200\n2026-01-15 10:07:58,166 INFO     - *                | ec419103-f - Received\n2026-01-15 10:07:58,167 INFO     - *                | ec419103-f - Processed\n      INFO   127.0.0.1:53788 - &amp;quot;GET /trace HTTP/1.1&amp;quot; 200\n{&amp;#x27;body&amp;#x27;: &amp;#x27;Startup!!!&amp;#x27;, &amp;#x27;content_type&amp;#x27;: &amp;#x27;text/plain&amp;#x27;, &amp;#x27;message_id&amp;#x27;: &amp;#x27;430b9fa3-e1a4-48cd-8cf8-4e8da4e6767b&amp;#x27;, &amp;#x27;correlation_id&amp;#x27;: &amp;#x27;430b9fa3-e1a4-48cd-8cf8-4e8da4e6767b&amp;#x27;, &amp;#x27;path&amp;#x27;: {}, &amp;#x27;committed&amp;#x27;: None, &amp;#x27;subject&amp;#x27;: &amp;#x27;test&amp;#x27;, &amp;#x27;reply&amp;#x27;: &amp;#x27;&amp;#x27;}\n{&amp;#x27;body&amp;#x27;: &amp;#x27;publishing ...&amp;#x27;, &amp;#x27;content_type&amp;#x27;: &amp;#x27;text/plain&amp;#x27;, &amp;#x27;message_id&amp;#x27;: &amp;#x27;ec419103-fe99-4071-845e-286e6e84b1f7&amp;#x27;, &amp;#x27;correlation_id&amp;#x27;: &amp;#x27;ec419103-fe99-4071-845e-286e6e84b1f7&amp;#x27;, &amp;#x27;path&amp;#x27;: {}, &amp;#x27;committed&amp;#x27;: None, &amp;#x27;subject&amp;#x27;: &amp;#x27;xxx&amp;#x27;, &amp;#x27;reply&amp;#x27;: &amp;#x27;&amp;#x27;}\n\n----------------------------- Captured stderr call -----------------------------\n[30395] 2026/01/15 10:07:57.008519 [INF] Starting nats-server\n[30395] 2026/01/15 10:07:57.008617 [INF]   Version:  2.12.3\n[30395] 2026/01/15 10:07:57.008632 [INF]   Git:      [450a519]\n[30395] 2026/01/15 10:07:57.008639 [INF]   Name:     NDGEVKHUAD3DBMGUWILK2G447UZWTBE7RWYREN73GH6MQTJ2HPO5DFF5\n[30395] 2026/01/15 10:07:57.008652 [INF]   ID:       NDGEVKHUAD3DBMGUWILK2G447UZWTBE7RWYREN73GH6MQTJ2HPO5DFF5\n[30395] 2026/01/15 10:07:57.009306 [INF] Listening for client connections on 0.0.0.0:8949\n[30395] 2026/01/15 10:07:57.009741 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:07:57,566 INFO     - FastStream app starting...\n2026-01-15 10:07:57,571 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:57,581 INFO     - FastStream app starting...\n2026-01-15 10:07:57,585 INFO     - FastStream app starting...\n2026-01-15 10:07:57,586 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:57,590 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:57,602 INFO     - FastStream app starting...\n2026-01-15 10:07:57,606 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:57,616 INFO     - FastStream app starting...\n2026-01-15 10:07:57,625 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:07:57,626 INFO     - FastStream app starting...\n2026-01-15 10:07:57,631 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [30413]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8404 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_je publie le message &amp;#x27;hello&amp;#x27; sur le canal &amp;#x27;healthcheck&amp;#x27;&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_je publie le message &amp;#x27;{msg}&amp;#x27; sur le canal &amp;#x27;{canal}&amp;#x27;&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 9168 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:9168\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8949 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:8949\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8404 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 9036 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:9036\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 9190 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:9190\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 9049 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:9049\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 8326 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:8326\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8420 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:8420\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 9083 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:9083\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 8801 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:8801\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8404 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8404 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x70f6b120ecf0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:57 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8404/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:8404\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8404 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x70f6b1582580&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:57 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;4&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8404/publish &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;obtiens le message &amp;#x27;toto&amp;#x27; sur le canal &amp;#x27;healthcheck_resp&amp;#x27;&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;obtiens le message &amp;#x27;{msg}&amp;#x27; sur le canal &amp;#x27;{canal}&amp;#x27;&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8404 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x70f6b12c6ad0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:07:57 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;430&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8404/trace &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [30413]\n2026-01-15 10:07:58,485 INFO     - FastStream app shutting down...\n2026-01-15 10:07:58,485 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:58,669 INFO     - FastStream app shutting down...\n2026-01-15 10:07:58,670 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:58,806 INFO     - FastStream app shutting down...\n2026-01-15 10:07:58,808 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:59,030 INFO     - FastStream app shutting down...\n2026-01-15 10:07:59,031 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:59,191 INFO     - FastStream app shutting down...\n2026-01-15 10:07:59,193 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:07:59,422 INFO     - FastStream app shutting down...\n2026-01-15 10:07:59,423 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_canal_pingpong&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_canal_pingpong&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_canal_pingpong&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function esb_sub at 0x70f6b1e9c540&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_canal_pingpong&amp;gt;&amp;gt;, kwargs = {&amp;#x27;canal&amp;#x27;: &amp;#x27;pong&amp;#x27;, &amp;#x27;world1&amp;#x27;: WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x70f6b15824...tream.FastStreamServiceContext object at 0x70f6b12bf700&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x70f6b128e390&amp;gt;)])}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nworld1 = WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x70f6b1582470&amp;gt;, pas=[PacServiceContext(...stream.FastStreamServiceContext object at 0x70f6b12bf700&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x70f6b128e390&amp;gt;)]), canal = &amp;#x27;pong&amp;#x27;\n\n    @when(\n        parsers.parse(&amp;quot;j&amp;#x27;\u00e9coute le canal &amp;#x27;{canal}&amp;#x27;&amp;quot;),\n    )\n    def esb_sub(\n        world1: WorldContext,\n        canal: str,\n    ):\n        global handle_GLOBAL\n    \n        print(f&amp;quot;esb_sub {canal=}...&amp;quot;)\n        #raise NotImplementedError()\n&amp;gt;       broker = world1.pa.broker\n                 ^^^^^^^^^^^^^^^^\nE       AttributeError: &amp;#x27;PacServiceContext&amp;#x27; object has no attribute &amp;#x27;broker&amp;#x27;\n\nsrc/pac_bdd/esb.py:25: AttributeError\n\n----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:8586/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8948 ...\n2026-01-15 10:08:00,118 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:08:00,119 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8948 ...\n2026-01-15 10:08:00,151 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\nConnecting to NATS nats://localhost:8948 ...\n2026-01-15 10:08:00,151 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-15 10:08:00,152 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:08:00,152 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8948 ...\n2026-01-15 10:08:00,156 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:08:00,157 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8948 ...\n2026-01-15 10:08:00,170 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:08:00,170 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8948 ...\n2026-01-15 10:08:00,191 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:08:00,192 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:08:00,192 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:00,193 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:00,193 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:00,194 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:00,194 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:08:00,194 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:00,195 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:00,195 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:08:00,195 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:08:00,196 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:00,196 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:00,197 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:08:00,197 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8948 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8586\n    server   Documentation at http://0.0.0.0:8586/docs\n \n             Logs:\n \n2026-01-15 10:08:00,372 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:08:00,374 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:08:00,374 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:08:00,375 INFO     - *                | b144d8b0-9 - Received\n2026-01-15 10:08:00,379 INFO     - *                | b144d8b0-9 - Processed\n_check_http_health http://localhost:8586/healthcheck\n      INFO   127.0.0.1:35100 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\nesb_sub canal=&amp;#x27;pong&amp;#x27;...\n\n----------------------------- Captured stderr call -----------------------------\n[30479] 2026/01/15 10:07:59.570325 [INF] Starting nats-server\n[30479] 2026/01/15 10:07:59.570403 [INF]   Version:  2.12.3\n[30479] 2026/01/15 10:07:59.570409 [INF]   Git:      [450a519]\n[30479] 2026/01/15 10:07:59.570413 [INF]   Name:     NAM7BNBCKV2MB7MLZG5SVU344HAOMX5VKZTK6RNRNR64MUHF2IVM24JH\n[30479] 2026/01/15 10:07:59.570417 [INF]   ID:       NAM7BNBCKV2MB7MLZG5SVU344HAOMX5VKZTK6RNRNR64MUHF2IVM24JH\n[30479] 2026/01/15 10:07:59.571048 [INF] Listening for client connections on 0.0.0.0:8948\n[30479] 2026/01/15 10:07:59.571462 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\n2026-01-15 10:08:00,114 INFO     - FastStream app starting...\n2026-01-15 10:08:00,119 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:08:00,147 INFO     - FastStream app starting...\n2026-01-15 10:08:00,147 INFO     - FastStream app starting...\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:08:00,152 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:08:00,152 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:08:00,153 INFO     - FastStream app starting...\n2026-01-15 10:08:00,157 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:08:00,166 INFO     - FastStream app starting...\n2026-01-15 10:08:00,170 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:08:00,187 INFO     - FastStream app starting...\n2026-01-15 10:08:00,197 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [30494]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8586 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;\u00e9coute le canal &amp;#x27;pong&amp;#x27;&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;\u00e9coute le canal &amp;#x27;{canal}&amp;#x27;&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8768 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:8768\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8948 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:8948\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8586 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8919 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:8919\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 8465 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:8465\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 8804 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:8804\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 8914 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:8914\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8499 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:8499\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 8430 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:8430\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 9180 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:9180\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8586 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8586 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x70f6b1577250&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:08:00 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8586/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:8586\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [30494]\n2026-01-15 10:08:00,918 INFO     - FastStream app shutting down...\n2026-01-15 10:08:00,919 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:08:01,051 INFO     - FastStream app shutting down...\n2026-01-15 10:08:01,052 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:08:01,270 INFO     - FastStream app shutting down...\n2026-01-15 10:08:01,272 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:08:01,453 INFO     - FastStream app shutting down...\n2026-01-15 10:08:01,455 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:08:01,658 INFO     - FastStream app shutting down...\n2026-01-15 10:08:01,659 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:08:01,792 INFO     - FastStream app shutting down...\n2026-01-15 10:08:01,793 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;la PA #pa1&amp;quot;. Line 7 in scenario &amp;quot;2 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/pa_multiple.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_peppol_req&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_peppol_req&#34;, &#34;duration&#34;: &#34;5 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_peppol_req&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;5 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_le service PEPPOL simul\u00e9 avec:&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_le service PEPPOL simul\u00e9 avec:&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8392 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:8392\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_md5&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_md5&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_md5&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function check_result at 0x70f6b1ef2160&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_md5&amp;gt;&amp;gt;, kwargs = {&amp;#x27;peppol_context&amp;#x27;: PeppolContext(sml_zone=&amp;#x27;acc.edelivery.tech.ec.europa.eu&amp;#x27;, enterprise_id=None, siren=None, siret=None, result=&amp;#x27;b881aaeff8eeaed7190491ccdeaa42fc&amp;#x27;), &amp;#x27;result&amp;#x27;: &amp;#x27;6c2675d749449f2c8af1216fd866bb54&amp;#x27;}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\npeppol_context = PeppolContext(sml_zone=&amp;#x27;acc.edelivery.tech.ec.europa.eu&amp;#x27;, enterprise_id=None, siren=None, siret=None, result=&amp;#x27;b881aaeff8eeaed7190491ccdeaa42fc&amp;#x27;), result = &amp;#x27;6c2675d749449f2c8af1216fd866bb54&amp;#x27;\n\n    @then(parsers.parse(&amp;#x27;&amp;#x27;&amp;#x27;j&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27;&amp;#x27;&amp;#x27;))\n    def check_result(\n        peppol_context: PeppolContext,\n        result: str,\n    ):\n        &amp;quot;&amp;quot;&amp;quot;\u00e9tape g\u00e9n\u00e9rique pour tester tout r\u00e9sultat&amp;quot;&amp;quot;&amp;quot;\n        if peppol_context.result != result:\n            print(f&amp;quot;result: {peppol_context.result}&amp;quot;)\n            print(f&amp;quot;expecting: {result}&amp;quot;)\n&amp;gt;       assert peppol_context.result == result\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE       AssertionError\n\nsrc/pac_bdd/peppol.py:129: AssertionError\n\n----------------------------- Captured stdout call -----------------------------\nresult: b881aaeff8eeaed7190491ccdeaa42fc\nexpecting: 6c2675d749449f2c8af1216fd866bb54\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte md5 de &amp;quot;bonjour!&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte md5 de &amp;quot;{msg}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;, &amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;6c2675d749449f2c8af1216fd866bb54&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_identification_france&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_identification_france&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_identification_france&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\nxxxx 0002 0002\nxxxx 0009 0009\nxxxx 9957 9957\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_l\\&amp;#x27;identification par SIRET porte le code &amp;quot;0002&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_l\\&amp;#x27;identification par {facon} porte le code &amp;quot;{code}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_l\\&amp;#x27;identification par SIREN porte le code &amp;quot;0009&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_l\\&amp;#x27;identification par {facon} porte le code &amp;quot;{code}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_l\\&amp;#x27;identification par TVA_FR porte le code &amp;quot;9957&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_l\\&amp;#x27;identification par {facon} porte le code &amp;quot;{code}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_empreinte_participant&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_empreinte_participant&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_empreinte_participant&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte SIREN &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;3ddb2999105b666703fc700e14885016&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte SIRET &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;6dbdf4f29451b37456ca48b550bdbaee&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte TVA_FR &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;d0d6bafc0317e3e8baa9504a9a022f9c&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_h\u00f4te_sml&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_h\u00f4te_sml&#34;, &#34;duration&#34;: &#34;3 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_h\u00f4te_sml&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;3 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_la racine SML &amp;quot;ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_la racine SML &amp;quot;{zone}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIREN &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-3ddb2999105b666703fc700e14885016.iso6523-actorid-upis.ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIRET &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-6dbdf4f29451b37456ca48b550bdbaee.iso6523-actorid-upis.ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour TVA_FR &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-d0d6bafc0317e3e8baa9504a9a022f9c.iso6523-actorid-upis.ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_la racine SML &amp;quot;acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_la racine SML &amp;quot;{zone}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIREN &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-3ddb2999105b666703fc700e14885016.iso6523-actorid-upis.acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIRET &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-6dbdf4f29451b37456ca48b550bdbaee.iso6523-actorid-upis.acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour TVA_FR &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-d0d6bafc0317e3e8baa9504a9a022f9c.iso6523-actorid-upis.acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_rejet_dolibarr&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_rejet_dolibarr&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_rejet_dolibarr&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function compliance_rule_set at 0x70f6b1d10d60&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_rejet_dolibarr&amp;gt;&amp;gt;, kwargs = {}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @when(&amp;quot;je d\u00e9finis un contr\u00f4le de conformit\u00e9 m\u00e9tier fournisseur&amp;quot;)\n    def compliance_rule_set():\n&amp;gt;       raise NotImplementedError()\nE       NotImplementedError\n\nsrc/pac_bdd/tobeimplemented.py:45: NotImplementedError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je d\u00e9finis un contr\u00f4le de conformit\u00e9 m\u00e9tier fournisseur&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je d\u00e9finis un contr\u00f4le de conformit\u00e9 m\u00e9tier fournisseur&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_cycle_basique&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_cycle_basique&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_cycle_basique&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function esb_sub_msg2 at 0x70f6b1e9cae0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_cycle_basique&amp;gt;&amp;gt;, kwargs = {&amp;#x27;canal&amp;#x27;: &amp;#x27;controle-formats-IN&amp;#x27;, &amp;#x27;msg&amp;#x27;: &amp;#x27;hello&amp;#x27;, &amp;#x27;world1&amp;#x27;: WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServic...tream.FastStreamServiceContext object at 0x70f6b13fcd70&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x70f6b128dcd0&amp;gt;)])}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nworld1 = WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x70f6b12a6250&amp;gt;, pas=[PacServiceContext(...stream.FastStreamServiceContext object at 0x70f6b13fcd70&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x70f6b128dcd0&amp;gt;)]), msg = &amp;#x27;hello&amp;#x27;, canal = &amp;#x27;controle-formats-IN&amp;#x27;\n\n    @then(parsers.parse(&amp;quot;&amp;quot;&amp;quot;j&amp;#x27;obtiens le message &amp;#x27;{msg}&amp;#x27; sur le canal &amp;#x27;{canal}&amp;#x27;&amp;quot;&amp;quot;&amp;quot;))\n    def esb_sub_msg2(\n        world1: WorldContext,\n        msg: str,\n        canal: str,\n    ):\n        traces = []\n        with world1.pa1.api_gateway.get_client() as client:\n            response = client.get(&amp;quot;/trace&amp;quot;)\n            assert response.status_code == 200\n            traces = response.json()\n    \n        for trace in traces:\n            print(trace)\n            if trace[&amp;quot;subject&amp;quot;] == canal and trace[&amp;quot;body&amp;quot;] == msg:\n                return\n        else:\n&amp;gt;           raise Exception(&amp;quot;message not found !&amp;quot;)\nE           Exception: message not found !\n\nsrc/pac_bdd/esb.py:78: Exception\n\n----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:8731/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:9002 ...\n2026-01-15 10:08:02,578 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:08:02,579 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9002 ...\n2026-01-15 10:08:02,602 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\nConnecting to NATS nats://localhost:9002 ...\n2026-01-15 10:08:02,602 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:08:02,603 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:08:02,603 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9002 ...\n2026-01-15 10:08:02,603 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:08:02,604 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9002 ...\n2026-01-15 10:08:02,622 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-15 10:08:02,623 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9002 ...\n2026-01-15 10:08:02,631 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:08:02,631 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:08:02,632 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:02,632 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:02,632 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:02,633 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:02,633 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:08:02,634 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:02,634 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:02,634 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:08:02,635 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:08:02,635 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:02,635 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:08:02,636 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:08:02,636 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:9002 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8731\n    server   Documentation at http://0.0.0.0:8731/docs\n \n             Logs:\n \n2026-01-15 10:08:02,796 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:08:02,797 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:08:02,798 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:08:02,799 INFO     - *                | 021c9f56-d - Received\n2026-01-15 10:08:02,802 INFO     - *                | 021c9f56-d - Processed\n_check_http_health http://localhost:8731/healthcheck\n      INFO   127.0.0.1:42830 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:42846 - &amp;quot;POST /publish HTTP/1.1&amp;quot; 200\n2026-01-15 10:08:03,215 INFO     - *                | 6dc3ea40-f - Received\n2026-01-15 10:08:03,215 INFO     - *                | 6dc3ea40-f - Processed\n      INFO   127.0.0.1:42854 - &amp;quot;GET /trace HTTP/1.1&amp;quot; 200\n{&amp;#x27;body&amp;#x27;: &amp;#x27;Startup!!!&amp;#x27;, &amp;#x27;content_type&amp;#x27;: &amp;#x27;text/plain&amp;#x27;, &amp;#x27;message_id&amp;#x27;: &amp;#x27;021c9f56-d4e7-4ddd-b514-30accef9cf09&amp;#x27;, &amp;#x27;correlation_id&amp;#x27;: &amp;#x27;021c9f56-d4e7-4ddd-b514-30accef9cf09&amp;#x27;, &amp;#x27;path&amp;#x27;: {}, &amp;#x27;committed&amp;#x27;: None, &amp;#x27;subject&amp;#x27;: &amp;#x27;test&amp;#x27;, &amp;#x27;reply&amp;#x27;: &amp;#x27;&amp;#x27;}\n{&amp;#x27;body&amp;#x27;: &amp;#x27;publishing ...&amp;#x27;, &amp;#x27;content_type&amp;#x27;: &amp;#x27;text/plain&amp;#x27;, &amp;#x27;message_id&amp;#x27;: &amp;#x27;6dc3ea40-fd1e-4f17-b572-cbd4e0e572ad&amp;#x27;, &amp;#x27;correlation_id&amp;#x27;: &amp;#x27;6dc3ea40-fd1e-4f17-b572-cbd4e0e572ad&amp;#x27;, &amp;#x27;path&amp;#x27;: {}, &amp;#x27;committed&amp;#x27;: None, &amp;#x27;subject&amp;#x27;: &amp;#x27;xxx&amp;#x27;, &amp;#x27;reply&amp;#x27;: &amp;#x27;&amp;#x27;}\n\n----------------------------- Captured stderr call -----------------------------\n[30564] 2026/01/15 10:08:02.045104 [INF] Starting nats-server\n[30564] 2026/01/15 10:08:02.045198 [INF]   Version:  2.12.3\n[30564] 2026/01/15 10:08:02.045203 [INF]   Git:      [450a519]\n[30564] 2026/01/15 10:08:02.045207 [INF]   Name:     NDDSJECDUQRQJSZF7R5OTXTSTCIIL45MSNHVPATF6U4W5IIM5H32EZJR\n[30564] 2026/01/15 10:08:02.045217 [INF]   ID:       NDDSJECDUQRQJSZF7R5OTXTSTCIIL45MSNHVPATF6U4W5IIM5H32EZJR\n[30564] 2026/01/15 10:08:02.046089 [INF] Listening for client connections on 0.0.0.0:9002\n[30564] 2026/01/15 10:08:02.046503 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\n2026-01-15 10:08:02,574 INFO     - FastStream app starting...\n2026-01-15 10:08:02,579 INFO     - FastStream app started successfully! To exit, press CTRL+C\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:08:02,598 INFO     - FastStream app starting...\n2026-01-15 10:08:02,598 INFO     - FastStream app starting...\n2026-01-15 10:08:02,600 INFO     - FastStream app starting...\n2026-01-15 10:08:02,603 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:08:02,603 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:08:02,604 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:08:02,618 INFO     - FastStream app starting...\n2026-01-15 10:08:02,623 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:08:02,627 INFO     - FastStream app starting...\n2026-01-15 10:08:02,636 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [30579]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8731 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_je publie le message &amp;#x27;hello&amp;#x27; sur le canal &amp;#x27;api-gateway-OUT&amp;#x27;&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_je publie le message &amp;#x27;{msg}&amp;#x27; sur le canal &amp;#x27;{canal}&amp;#x27;&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8787 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:8787\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 9002 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:9002\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8731 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8421 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:8421\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 8923 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:8923\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 8918 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:8918\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 8407 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:8407\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 9086 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:9086\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 8369 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:8369\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 8492 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:8492\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8731 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8731 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x70f6b12a6750&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:08:02 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8731/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:8731\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8731 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x70f6b12a7450&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:08:02 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;4&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8731/publish &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;obtiens le message &amp;#x27;hello&amp;#x27; sur le canal &amp;#x27;controle-formats-IN&amp;#x27;&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;obtiens le message &amp;#x27;{msg}&amp;#x27; sur le canal &amp;#x27;{canal}&amp;#x27;&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8731 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x70f6b1326850&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:08:02 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;430&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8731/trace &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [30579]\n2026-01-15 10:08:03,477 INFO     - FastStream app shutting down...\n2026-01-15 10:08:03,478 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:08:03,703 INFO     - FastStream app shutting down...\n2026-01-15 10:08:03,705 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:08:03,904 INFO     - FastStream app shutting down...\n2026-01-15 10:08:03,906 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:08:04,024 INFO     - FastStream app shutting down...\n2026-01-15 10:08:04,025 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:08:04,205 INFO     - FastStream app shutting down...\n2026-01-15 10:08:04,206 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:08:04,437 INFO     - FastStream app shutting down...\n2026-01-15 10:08:04,438 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_facture_rejet\u00e9e&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_facture_rejet\u00e9e&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_facture_rejet\u00e9e&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function submit_invoice_simple at 0x70f6b1d10400&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_facture_rejet\u00e9e&amp;gt;&amp;gt;, kwargs = {}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @when(&amp;quot;je d\u00e9pose une facture&amp;quot;)\n    def submit_invoice_simple():\n        # POST /\n&amp;gt;       raise NotImplementedError()\nE       NotImplementedError\n\nsrc/pac_bdd/tobeimplemented.py:17: NotImplementedError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je d\u00e9pose une facture&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je d\u00e9pose une facture&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}]}, &#34;renderCollapsed&#34;: [&#34;passed&#34;], &#34;initialSort&#34;: &#34;result&#34;, &#34;title&#34;: &#34;report.html&#34;}"></div>
    <script>
      (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
const { getCollapsedCategory, setCollapsedIds } = require('./storage.js')

class DataManager {
    setManager(data) {
        const collapsedCategories = [...getCollapsedCategory(data.renderCollapsed)]
        const collapsedIds = []
        const tests = Object.values(data.tests).flat().map((test, index) => {
            const collapsed = collapsedCategories.includes(test.result.toLowerCase())
            const id = `test_${index}`
            if (collapsed) {
                collapsedIds.push(id)
            }
            return {
                ...test,
                id,
                collapsed,
            }
        })
        const dataBlob = { ...data, tests }
        this.data = { ...dataBlob }
        this.renderData = { ...dataBlob }
        setCollapsedIds(collapsedIds)
    }

    get allData() {
        return { ...this.data }
    }

    resetRender() {
        this.renderData = { ...this.data }
    }

    setRender(data) {
        this.renderData.tests = [...data]
    }

    toggleCollapsedItem(id) {
        this.renderData.tests = this.renderData.tests.map((test) =>
            test.id === id ? { ...test, collapsed: !test.collapsed } : test,
        )
    }

    set allCollapsed(collapsed) {
        this.renderData = { ...this.renderData, tests: [...this.renderData.tests.map((test) => (
            { ...test, collapsed }
        ))] }
    }

    get testSubset() {
        return [...this.renderData.tests]
    }

    get environment() {
        return this.renderData.environment
    }

    get initialSort() {
        return this.data.initialSort
    }
}

module.exports = {
    manager: new DataManager(),
}

},{"./storage.js":8}],2:[function(require,module,exports){
const mediaViewer = require('./mediaviewer.js')
const templateEnvRow = document.getElementById('template_environment_row')
const templateResult = document.getElementById('template_results-table__tbody')

function htmlToElements(html) {
    const temp = document.createElement('template')
    temp.innerHTML = html
    return temp.content.childNodes
}

const find = (selector, elem) => {
    if (!elem) {
        elem = document
    }
    return elem.querySelector(selector)
}

const findAll = (selector, elem) => {
    if (!elem) {
        elem = document
    }
    return [...elem.querySelectorAll(selector)]
}

const dom = {
    getStaticRow: (key, value) => {
        const envRow = templateEnvRow.content.cloneNode(true)
        const isObj = typeof value === 'object' && value !== null
        const values = isObj ? Object.keys(value).map((k) => `${k}: ${value[k]}`) : null

        const valuesElement = htmlToElements(
            values ? `<ul>${values.map((val) => `<li>${val}</li>`).join('')}<ul>` : `<div>${value}</div>`)[0]
        const td = findAll('td', envRow)
        td[0].textContent = key
        td[1].appendChild(valuesElement)

        return envRow
    },
    getResultTBody: ({ testId, id, log, extras, resultsTableRow, tableHtml, result, collapsed }) => {
        const resultBody = templateResult.content.cloneNode(true)
        resultBody.querySelector('tbody').classList.add(result.toLowerCase())
        resultBody.querySelector('tbody').id = testId
        resultBody.querySelector('.collapsible').dataset.id = id

        resultsTableRow.forEach((html) => {
            const t = document.createElement('template')
            t.innerHTML = html
            resultBody.querySelector('.collapsible').appendChild(t.content)
        })

        if (log) {
            // Wrap lines starting with "E" with span.error to color those lines red
            const wrappedLog = log.replace(/^E.*$/gm, (match) => `<span class="error">${match}</span>`)
            resultBody.querySelector('.log').innerHTML = wrappedLog
        } else {
            resultBody.querySelector('.log').remove()
        }

        if (collapsed) {
            resultBody.querySelector('.collapsible > td')?.classList.add('collapsed')
            resultBody.querySelector('.extras-row').classList.add('hidden')
        } else {
            resultBody.querySelector('.collapsible > td')?.classList.remove('collapsed')
        }

        const media = []
        extras?.forEach(({ name, format_type, content }) => {
            if (['image', 'video'].includes(format_type)) {
                media.push({ path: content, name, format_type })
            }

            if (format_type === 'html') {
                resultBody.querySelector('.extraHTML').insertAdjacentHTML('beforeend', `<div>${content}</div>`)
            }
        })
        mediaViewer.setup(resultBody, media)

        // Add custom html from the pytest_html_results_table_html hook
        tableHtml?.forEach((item) => {
            resultBody.querySelector('td[class="extra"]').insertAdjacentHTML('beforeend', item)
        })

        return resultBody
    },
}

module.exports = {
    dom,
    htmlToElements,
    find,
    findAll,
}

},{"./mediaviewer.js":6}],3:[function(require,module,exports){
const { manager } = require('./datamanager.js')
const { doSort } = require('./sort.js')
const storageModule = require('./storage.js')

const getFilteredSubSet = (filter) =>
    manager.allData.tests.filter(({ result }) => filter.includes(result.toLowerCase()))

const doInitFilter = () => {
    const currentFilter = storageModule.getVisible()
    const filteredSubset = getFilteredSubSet(currentFilter)
    manager.setRender(filteredSubset)
}

const doFilter = (type, show) => {
    if (show) {
        storageModule.showCategory(type)
    } else {
        storageModule.hideCategory(type)
    }

    const currentFilter = storageModule.getVisible()
    const filteredSubset = getFilteredSubSet(currentFilter)
    manager.setRender(filteredSubset)

    const sortColumn = storageModule.getSort()
    doSort(sortColumn, true)
}

module.exports = {
    doFilter,
    doInitFilter,
}

},{"./datamanager.js":1,"./sort.js":7,"./storage.js":8}],4:[function(require,module,exports){
const { redraw, bindEvents, renderStatic } = require('./main.js')
const { doInitFilter } = require('./filter.js')
const { doInitSort } = require('./sort.js')
const { manager } = require('./datamanager.js')
const data = JSON.parse(document.getElementById('data-container').dataset.jsonblob)

function init() {
    manager.setManager(data)
    doInitFilter()
    doInitSort()
    renderStatic()
    redraw()
    bindEvents()
}

init()

},{"./datamanager.js":1,"./filter.js":3,"./main.js":5,"./sort.js":7}],5:[function(require,module,exports){
const { dom, find, findAll } = require('./dom.js')
const { manager } = require('./datamanager.js')
const { doSort } = require('./sort.js')
const { doFilter } = require('./filter.js')
const {
    getVisible,
    getCollapsedIds,
    setCollapsedIds,
    getSort,
    getSortDirection,
    possibleFilters,
} = require('./storage.js')

const removeChildren = (node) => {
    while (node.firstChild) {
        node.removeChild(node.firstChild)
    }
}

const renderStatic = () => {
    const renderEnvironmentTable = () => {
        const environment = manager.environment
        const rows = Object.keys(environment).map((key) => dom.getStaticRow(key, environment[key]))
        const table = document.getElementById('environment')
        removeChildren(table)
        rows.forEach((row) => table.appendChild(row))
    }
    renderEnvironmentTable()
}

const addItemToggleListener = (elem) => {
    elem.addEventListener('click', ({ target }) => {
        const id = target.parentElement.dataset.id
        manager.toggleCollapsedItem(id)

        const collapsedIds = getCollapsedIds()
        if (collapsedIds.includes(id)) {
            const updated = collapsedIds.filter((item) => item !== id)
            setCollapsedIds(updated)
        } else {
            collapsedIds.push(id)
            setCollapsedIds(collapsedIds)
        }
        redraw()
    })
}

const renderContent = (tests) => {
    const sortAttr = getSort(manager.initialSort)
    const sortAsc = JSON.parse(getSortDirection())
    const rows = tests.map(dom.getResultTBody)
    const table = document.getElementById('results-table')
    const tableHeader = document.getElementById('results-table-head')

    const newTable = document.createElement('table')
    newTable.id = 'results-table'

    // remove all sorting classes and set the relevant
    findAll('.sortable', tableHeader).forEach((elem) => elem.classList.remove('asc', 'desc'))
    tableHeader.querySelector(`.sortable[data-column-type="${sortAttr}"]`)?.classList.add(sortAsc ? 'desc' : 'asc')
    newTable.appendChild(tableHeader)

    if (!rows.length) {
        const emptyTable = document.getElementById('template_results-table__body--empty').content.cloneNode(true)
        newTable.appendChild(emptyTable)
    } else {
        rows.forEach((row) => {
            if (!!row) {
                findAll('.collapsible td:not(.col-links', row).forEach(addItemToggleListener)
                find('.logexpander', row).addEventListener('click',
                    (evt) => evt.target.parentNode.classList.toggle('expanded'),
                )
                newTable.appendChild(row)
            }
        })
    }

    table.replaceWith(newTable)
}

const renderDerived = () => {
    const currentFilter = getVisible()
    possibleFilters.forEach((result) => {
        const input = document.querySelector(`input[data-test-result="${result}"]`)
        input.checked = currentFilter.includes(result)
    })
}

const bindEvents = () => {
    const filterColumn = (evt) => {
        const { target: element } = evt
        const { testResult } = element.dataset

        doFilter(testResult, element.checked)
        const collapsedIds = getCollapsedIds()
        const updated = manager.renderData.tests.map((test) => {
            return {
                ...test,
                collapsed: collapsedIds.includes(test.id),
            }
        })
        manager.setRender(updated)
        redraw()
    }

    const header = document.getElementById('environment-header')
    header.addEventListener('click', () => {
        const table = document.getElementById('environment')
        table.classList.toggle('hidden')
        header.classList.toggle('collapsed')
    })

    findAll('input[name="filter_checkbox"]').forEach((elem) => {
        elem.addEventListener('click', filterColumn)
    })

    findAll('.sortable').forEach((elem) => {
        elem.addEventListener('click', (evt) => {
            const { target: element } = evt
            const { columnType } = element.dataset
            doSort(columnType)
            redraw()
        })
    })

    document.getElementById('show_all_details').addEventListener('click', () => {
        manager.allCollapsed = false
        setCollapsedIds([])
        redraw()
    })
    document.getElementById('hide_all_details').addEventListener('click', () => {
        manager.allCollapsed = true
        const allIds = manager.renderData.tests.map((test) => test.id)
        setCollapsedIds(allIds)
        redraw()
    })
}

const redraw = () => {
    const { testSubset } = manager

    renderContent(testSubset)
    renderDerived()
}

module.exports = {
    redraw,
    bindEvents,
    renderStatic,
}

},{"./datamanager.js":1,"./dom.js":2,"./filter.js":3,"./sort.js":7,"./storage.js":8}],6:[function(require,module,exports){
class MediaViewer {
    constructor(assets) {
        this.assets = assets
        this.index = 0
    }

    nextActive() {
        this.index = this.index === this.assets.length - 1 ? 0 : this.index + 1
        return [this.activeFile, this.index]
    }

    prevActive() {
        this.index = this.index === 0 ? this.assets.length - 1 : this.index -1
        return [this.activeFile, this.index]
    }

    get currentIndex() {
        return this.index
    }

    get activeFile() {
        return this.assets[this.index]
    }
}


const setup = (resultBody, assets) => {
    if (!assets.length) {
        resultBody.querySelector('.media').classList.add('hidden')
        return
    }

    const mediaViewer = new MediaViewer(assets)
    const container = resultBody.querySelector('.media-container')
    const leftArrow = resultBody.querySelector('.media-container__nav--left')
    const rightArrow = resultBody.querySelector('.media-container__nav--right')
    const mediaName = resultBody.querySelector('.media__name')
    const counter = resultBody.querySelector('.media__counter')
    const imageEl = resultBody.querySelector('img')
    const sourceEl = resultBody.querySelector('source')
    const videoEl = resultBody.querySelector('video')

    const setImg = (media, index) => {
        if (media?.format_type === 'image') {
            imageEl.src = media.path

            imageEl.classList.remove('hidden')
            videoEl.classList.add('hidden')
        } else if (media?.format_type === 'video') {
            sourceEl.src = media.path

            videoEl.classList.remove('hidden')
            imageEl.classList.add('hidden')
        }

        mediaName.innerText = media?.name
        counter.innerText = `${index + 1} / ${assets.length}`
    }
    setImg(mediaViewer.activeFile, mediaViewer.currentIndex)

    const moveLeft = () => {
        const [media, index] = mediaViewer.prevActive()
        setImg(media, index)
    }
    const doRight = () => {
        const [media, index] = mediaViewer.nextActive()
        setImg(media, index)
    }
    const openImg = () => {
        window.open(mediaViewer.activeFile.path, '_blank')
    }
    if (assets.length === 1) {
        container.classList.add('media-container--fullscreen')
    } else {
        leftArrow.addEventListener('click', moveLeft)
        rightArrow.addEventListener('click', doRight)
    }
    imageEl.addEventListener('click', openImg)
}

module.exports = {
    setup,
}

},{}],7:[function(require,module,exports){
const { manager } = require('./datamanager.js')
const storageModule = require('./storage.js')

const genericSort = (list, key, ascending, customOrder) => {
    let sorted
    if (customOrder) {
        sorted = list.sort((a, b) => {
            const aValue = a.result.toLowerCase()
            const bValue = b.result.toLowerCase()

            const aIndex = customOrder.findIndex((item) => item.toLowerCase() === aValue)
            const bIndex = customOrder.findIndex((item) => item.toLowerCase() === bValue)

            // Compare the indices to determine the sort order
            return aIndex - bIndex
        })
    } else {
        sorted = list.sort((a, b) => a[key] === b[key] ? 0 : a[key] > b[key] ? 1 : -1)
    }

    if (ascending) {
        sorted.reverse()
    }
    return sorted
}

const durationSort = (list, ascending) => {
    const parseDuration = (duration) => {
        if (duration.includes(':')) {
            // If it's in the format "HH:mm:ss"
            const [hours, minutes, seconds] = duration.split(':').map(Number)
            return (hours * 3600 + minutes * 60 + seconds) * 1000
        } else {
            // If it's in the format "nnn ms"
            return parseInt(duration)
        }
    }
    const sorted = list.sort((a, b) => parseDuration(a['duration']) - parseDuration(b['duration']))
    if (ascending) {
        sorted.reverse()
    }
    return sorted
}

const doInitSort = () => {
    const type = storageModule.getSort(manager.initialSort)
    const ascending = storageModule.getSortDirection()
    const list = manager.testSubset
    const initialOrder = ['Error', 'Failed', 'Rerun', 'XFailed', 'XPassed', 'Skipped', 'Passed']

    storageModule.setSort(type)
    storageModule.setSortDirection(ascending)

    if (type?.toLowerCase() === 'original') {
        manager.setRender(list)
    } else {
        let sortedList
        switch (type) {
        case 'duration':
            sortedList = durationSort(list, ascending)
            break
        case 'result':
            sortedList = genericSort(list, type, ascending, initialOrder)
            break
        default:
            sortedList = genericSort(list, type, ascending)
            break
        }
        manager.setRender(sortedList)
    }
}

const doSort = (type, skipDirection) => {
    const newSortType = storageModule.getSort(manager.initialSort) !== type
    const currentAsc = storageModule.getSortDirection()
    let ascending
    if (skipDirection) {
        ascending = currentAsc
    } else {
        ascending = newSortType ? false : !currentAsc
    }
    storageModule.setSort(type)
    storageModule.setSortDirection(ascending)

    const list = manager.testSubset
    const sortedList = type === 'duration' ? durationSort(list, ascending) : genericSort(list, type, ascending)
    manager.setRender(sortedList)
}

module.exports = {
    doInitSort,
    doSort,
}

},{"./datamanager.js":1,"./storage.js":8}],8:[function(require,module,exports){
const possibleFilters = [
    'passed',
    'skipped',
    'failed',
    'error',
    'xfailed',
    'xpassed',
    'rerun',
]

const getVisible = () => {
    const url = new URL(window.location.href)
    const settings = new URLSearchParams(url.search).get('visible')
    const lower = (item) => {
        const lowerItem = item.toLowerCase()
        if (possibleFilters.includes(lowerItem)) {
            return lowerItem
        }
        return null
    }
    return settings === null ?
        possibleFilters :
        [...new Set(settings?.split(',').map(lower).filter((item) => item))]
}

const hideCategory = (categoryToHide) => {
    const url = new URL(window.location.href)
    const visibleParams = new URLSearchParams(url.search).get('visible')
    const currentVisible = visibleParams ? visibleParams.split(',') : [...possibleFilters]
    const settings = [...new Set(currentVisible)].filter((f) => f !== categoryToHide).join(',')

    url.searchParams.set('visible', settings)
    window.history.pushState({}, null, unescape(url.href))
}

const showCategory = (categoryToShow) => {
    if (typeof window === 'undefined') {
        return
    }
    const url = new URL(window.location.href)
    const currentVisible = new URLSearchParams(url.search).get('visible')?.split(',').filter(Boolean) ||
        [...possibleFilters]
    const settings = [...new Set([categoryToShow, ...currentVisible])]
    const noFilter = possibleFilters.length === settings.length || !settings.length

    noFilter ? url.searchParams.delete('visible') : url.searchParams.set('visible', settings.join(','))
    window.history.pushState({}, null, unescape(url.href))
}

const getSort = (initialSort) => {
    const url = new URL(window.location.href)
    let sort = new URLSearchParams(url.search).get('sort')
    if (!sort) {
        sort = initialSort || 'result'
    }
    return sort
}

const setSort = (type) => {
    const url = new URL(window.location.href)
    url.searchParams.set('sort', type)
    window.history.pushState({}, null, unescape(url.href))
}

const getCollapsedCategory = (renderCollapsed) => {
    let categories
    if (typeof window !== 'undefined') {
        const url = new URL(window.location.href)
        const collapsedItems = new URLSearchParams(url.search).get('collapsed')
        switch (true) {
        case !renderCollapsed && collapsedItems === null:
            categories = ['passed']
            break
        case collapsedItems?.length === 0 || /^["']{2}$/.test(collapsedItems):
            categories = []
            break
        case /^all$/.test(collapsedItems) || collapsedItems === null && /^all$/.test(renderCollapsed):
            categories = [...possibleFilters]
            break
        default:
            categories = collapsedItems?.split(',').map((item) => item.toLowerCase()) || renderCollapsed
            break
        }
    } else {
        categories = []
    }
    return categories
}

const getSortDirection = () => JSON.parse(sessionStorage.getItem('sortAsc')) || false
const setSortDirection = (ascending) => sessionStorage.setItem('sortAsc', ascending)

const getCollapsedIds = () => JSON.parse(sessionStorage.getItem('collapsedIds')) || []
const setCollapsedIds = (list) => sessionStorage.setItem('collapsedIds', JSON.stringify(list))

module.exports = {
    getVisible,
    hideCategory,
    showCategory,
    getCollapsedIds,
    setCollapsedIds,
    getSort,
    setSort,
    getSortDirection,
    setSortDirection,
    getCollapsedCategory,
    possibleFilters,
}

},{}]},{},[4]);
    </script>
  </footer>
</html>
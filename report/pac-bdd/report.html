<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title id="head-title">report.html</title>
      <style type="text/css">body {
  font-family: Helvetica, Arial, sans-serif;
  font-size: 12px;
  /* do not increase min-width as some may use split screens */
  min-width: 800px;
  color: #999;
}

h1 {
  font-size: 24px;
  color: black;
}

h2 {
  font-size: 16px;
  color: black;
}

p {
  color: black;
}

a {
  color: #999;
}

table {
  border-collapse: collapse;
}

/******************************
 * SUMMARY INFORMATION
 ******************************/
#environment td {
  padding: 5px;
  border: 1px solid #e6e6e6;
  vertical-align: top;
}
#environment tr:nth-child(odd) {
  background-color: #f6f6f6;
}
#environment ul {
  margin: 0;
  padding: 0 20px;
}

/******************************
 * TEST RESULT COLORS
 ******************************/
span.passed,
.passed .col-result {
  color: green;
}

span.skipped,
span.xfailed,
span.rerun,
.skipped .col-result,
.xfailed .col-result,
.rerun .col-result {
  color: orange;
}

span.error,
span.failed,
span.xpassed,
.error .col-result,
.failed .col-result,
.xpassed .col-result {
  color: red;
}

.col-links__extra {
  margin-right: 3px;
}

/******************************
 * RESULTS TABLE
 *
 * 1. Table Layout
 * 2. Extra
 * 3. Sorting items
 *
 ******************************/
/*------------------
 * 1. Table Layout
 *------------------*/
#results-table {
  border: 1px solid #e6e6e6;
  color: #999;
  font-size: 12px;
  width: 100%;
}
#results-table th,
#results-table td {
  padding: 5px;
  border: 1px solid #e6e6e6;
  text-align: left;
}
#results-table th {
  font-weight: bold;
}

/*------------------
 * 2. Extra
 *------------------*/
.logwrapper {
  max-height: 230px;
  overflow-y: scroll;
  background-color: #e6e6e6;
}
.logwrapper.expanded {
  max-height: none;
}
.logwrapper.expanded .logexpander:after {
  content: "collapse [-]";
}
.logwrapper .logexpander {
  z-index: 1;
  position: sticky;
  top: 10px;
  width: max-content;
  border: 1px solid;
  border-radius: 3px;
  padding: 5px 7px;
  margin: 10px 0 10px calc(100% - 80px);
  cursor: pointer;
  background-color: #e6e6e6;
}
.logwrapper .logexpander:after {
  content: "expand [+]";
}
.logwrapper .logexpander:hover {
  color: #000;
  border-color: #000;
}
.logwrapper .log {
  min-height: 40px;
  position: relative;
  top: -50px;
  height: calc(100% + 50px);
  border: 1px solid #e6e6e6;
  color: black;
  display: block;
  font-family: "Courier New", Courier, monospace;
  padding: 5px;
  padding-right: 80px;
  white-space: pre-wrap;
}

div.media {
  border: 1px solid #e6e6e6;
  float: right;
  height: 240px;
  margin: 0 5px;
  overflow: hidden;
  width: 320px;
}

.media-container {
  display: grid;
  grid-template-columns: 25px auto 25px;
  align-items: center;
  flex: 1 1;
  overflow: hidden;
  height: 200px;
}

.media-container--fullscreen {
  grid-template-columns: 0px auto 0px;
}

.media-container__nav--right,
.media-container__nav--left {
  text-align: center;
  cursor: pointer;
}

.media-container__viewport {
  cursor: pointer;
  text-align: center;
  height: inherit;
}
.media-container__viewport img,
.media-container__viewport video {
  object-fit: cover;
  width: 100%;
  max-height: 100%;
}

.media__name,
.media__counter {
  display: flex;
  flex-direction: row;
  justify-content: space-around;
  flex: 0 0 25px;
  align-items: center;
}

.collapsible td:not(.col-links) {
  cursor: pointer;
}
.collapsible td:not(.col-links):hover::after {
  color: #bbb;
  font-style: italic;
  cursor: pointer;
}

.col-result {
  width: 130px;
}
.col-result:hover::after {
  content: " (hide details)";
}

.col-result.collapsed:hover::after {
  content: " (show details)";
}

#environment-header h2:hover::after {
  content: " (hide details)";
  color: #bbb;
  font-style: italic;
  cursor: pointer;
  font-size: 12px;
}

#environment-header.collapsed h2:hover::after {
  content: " (show details)";
  color: #bbb;
  font-style: italic;
  cursor: pointer;
  font-size: 12px;
}

/*------------------
 * 3. Sorting items
 *------------------*/
.sortable {
  cursor: pointer;
}
.sortable.desc:after {
  content: " ";
  position: relative;
  left: 5px;
  bottom: -12.5px;
  border: 10px solid #4caf50;
  border-bottom: 0;
  border-left-color: transparent;
  border-right-color: transparent;
}
.sortable.asc:after {
  content: " ";
  position: relative;
  left: 5px;
  bottom: 12.5px;
  border: 10px solid #4caf50;
  border-top: 0;
  border-left-color: transparent;
  border-right-color: transparent;
}

.hidden, .summary__reload__button.hidden {
  display: none;
}

.summary__data {
  flex: 0 0 550px;
}
.summary__reload {
  flex: 1 1;
  display: flex;
  justify-content: center;
}
.summary__reload__button {
  flex: 0 0 300px;
  display: flex;
  color: white;
  font-weight: bold;
  background-color: #4caf50;
  text-align: center;
  justify-content: center;
  align-items: center;
  border-radius: 3px;
  cursor: pointer;
}
.summary__reload__button:hover {
  background-color: #46a049;
}
.summary__spacer {
  flex: 0 0 550px;
}

.controls {
  display: flex;
  justify-content: space-between;
}

.filters,
.collapse {
  display: flex;
  align-items: center;
}
.filters button,
.collapse button {
  color: #999;
  border: none;
  background: none;
  cursor: pointer;
  text-decoration: underline;
}
.filters button:hover,
.collapse button:hover {
  color: #ccc;
}

.filter__label {
  margin-right: 10px;
}

      </style>
    
  </head>
  <body>
    <h1 id="title">report.html</h1>
    <p>Report generated on 14-Jan-2026 at 16:25:49 by <a href="https://pypi.python.org/pypi/pytest-html">pytest-html</a>
        v4.1.1</p>
    <div id="environment-header">
      <h2>Environment</h2>
    </div>
    <table id="environment"></table>
    <!-- TEMPLATES -->
      <template id="template_environment_row">
      <tr>
        <td></td>
        <td></td>
      </tr>
    </template>
    <template id="template_results-table__body--empty">
      <tbody class="results-table-row">
        <tr id="not-found-message">
          <td colspan="4">No results found. Check the filters.</th>
        </tr>
    </template>
    <template id="template_results-table__tbody">
      <tbody class="results-table-row">
        <tr class="collapsible">
        </tr>
        <tr class="extras-row">
          <td class="extra" colspan="4">
            <div class="extraHTML"></div>
            <div class="media">
              <div class="media-container">
                  <div class="media-container__nav--left"><</div>
                  <div class="media-container__viewport">
                    <img src="" />
                    <video controls>
                      <source src="" type="video/mp4">
                    </video>
                  </div>
                  <div class="media-container__nav--right">></div>
                </div>
                <div class="media__name"></div>
                <div class="media__counter"></div>
            </div>
            <div class="logwrapper">
              <div class="logexpander"></div>
              <div class="log"></div>
            </div>
          </td>
        </tr>
      </tbody>
    </template>
    <!-- END TEMPLATES -->
    <div class="summary">
      <div class="summary__data">
        <h2>Summary</h2>
        <div class="additional-summary prefix">
        </div>
        <p class="run-count">66 tests took 00:00:17.</p>
        <p class="filter">(Un)check the boxes to filter the results.</p>
        <div class="summary__reload">
          <div class="summary__reload__button hidden" onclick="location.reload()">
            <div>There are still tests running. <br />Reload this page to get the latest results!</div>
          </div>
        </div>
        <div class="summary__spacer"></div>
        <div class="controls">
          <div class="filters">
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="failed" />
            <span class="failed">55 Failed,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="passed" />
            <span class="passed">11 Passed,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="skipped" disabled/>
            <span class="skipped">0 Skipped,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="xfailed" disabled/>
            <span class="xfailed">0 Expected failures,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="xpassed" disabled/>
            <span class="xpassed">0 Unexpected passes,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="error" disabled/>
            <span class="error">0 Errors,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="rerun" disabled/>
            <span class="rerun">0 Reruns</span>
          </div>
          <div class="collapse">
            <button id="show_all_details">Show all details</button>&nbsp;/&nbsp;<button id="hide_all_details">Hide all details</button>
          </div>
        </div>
      </div>
      <div class="additional-summary summary">
      </div>
      <div class="additional-summary postfix">
      </div>
    </div>
    <table id="results-table">
      <thead id="results-table-head">
        <tr>
          <th class="sortable" data-column-type="result">Result</th>
          <th class="sortable" data-column-type="testId">Test</th>
          <th class="sortable" data-column-type="duration">Duration</th>
          <th>Links</th>
        </tr>
      </thead>
    </table>
  </body>
  <footer>
    <div id="data-container" data-jsonblob="{&#34;environment&#34;: {&#34;Python&#34;: &#34;3.13.2&#34;, &#34;Platform&#34;: &#34;Linux-6.8.0-90-generic-x86_64-with-glibc2.39&#34;, &#34;Packages&#34;: {&#34;pytest&#34;: &#34;8.4.2&#34;, &#34;pluggy&#34;: &#34;1.6.0&#34;}, &#34;Plugins&#34;: {&#34;html&#34;: &#34;4.1.1&#34;, &#34;bdd&#34;: &#34;8.1.0&#34;, &#34;metadata&#34;: &#34;3.1.1&#34;, &#34;asyncio&#34;: &#34;1.3.0&#34;, &#34;md-report&#34;: &#34;0.7.0&#34;, &#34;anyio&#34;: &#34;4.12.0&#34;}}, &#34;tests&#34;: {&#34;test_fixture.py::test_dummy_fixture&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_fixture.py::test_dummy_fixture&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_fixture.py::test_dummy_fixture&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;No log output captured.&#34;}], &#34;test_fixture.py::test_dummy_async_fixture&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_fixture.py::test_dummy_async_fixture&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_fixture.py::test_dummy_async_fixture&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log setup ------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n&#34;}], &#34;test_openapi.py::test_swagger_flow_service&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_openapi.py::test_swagger_flow_service&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_openapi.py::test_swagger_flow_service&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;def test_swagger_flow_service():\n        url = &amp;#x27;???&amp;#x27;\n&amp;gt;       _test_swagger(\n            url,\n            &amp;quot;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE A - PR XP Z12-013 - AFNOR-Flow_Service-1.1.0-swagger.json&amp;quot;,\n        )\n\ntest_openapi.py:24: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nurl = &amp;#x27;???&amp;#x27;, swagger = &amp;#x27;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE A - PR XP Z12-013 - AFNOR-Flow_Service-1.1.0-swagger.json&amp;#x27;\n\n    def _test_swagger(url: str, swagger: str):\n        &amp;quot;&amp;quot;&amp;quot;\n            V\u00e9rifier si une API respecte une definition Swagger/OpenAPI\n    \n        Cette API doit respecter le versioning indiqu\u00e9 dans l\u2019URL de la route API du Swagger. Dans un objectif de\n        simplification le versioning des routes n\u2019est pas affich\u00e9 dans le pr\u00e9sent document;\n        Dans cette API publi\u00e9e par le Fournisseur API ce dernier peut :\n        \u2022Avoir une URL sp\u00e9cifique en amont du versioning\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les requ\u00eates.\n        \u2022Ajouter des param\u00e8tres aux routes dans les requ\u00eates.\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les r\u00e9ponses.\n        \u2022Ajouter des codes erreurs dans les r\u00e9ponses.\n        &amp;quot;&amp;quot;&amp;quot;\n&amp;gt;       raise NotImplementedError(&amp;quot;swagger compliance non test\u00e9&amp;quot;)\nE       NotImplementedError: swagger compliance non test\u00e9\n\ntest_openapi.py:18: NotImplementedError\n&#34;}], &#34;test_openapi.py::test_swagger_directory_service&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_openapi.py::test_swagger_directory_service&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_openapi.py::test_swagger_directory_service&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;def test_swagger_directory_service():\n        url = &amp;quot;???&amp;quot;\n&amp;gt;       _test_swagger(\n            url,\n            &amp;quot;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE B - PR XP Z12-013 - AFNOR-Directory_Service-1.1.0-swagger.json&amp;quot;,\n        )\n\ntest_openapi.py:32: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nurl = &amp;#x27;???&amp;#x27;, swagger = &amp;#x27;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE B - PR XP Z12-013 - AFNOR-Directory_Service-1.1.0-swagger.json&amp;#x27;\n\n    def _test_swagger(url: str, swagger: str):\n        &amp;quot;&amp;quot;&amp;quot;\n            V\u00e9rifier si une API respecte une definition Swagger/OpenAPI\n    \n        Cette API doit respecter le versioning indiqu\u00e9 dans l\u2019URL de la route API du Swagger. Dans un objectif de\n        simplification le versioning des routes n\u2019est pas affich\u00e9 dans le pr\u00e9sent document;\n        Dans cette API publi\u00e9e par le Fournisseur API ce dernier peut :\n        \u2022Avoir une URL sp\u00e9cifique en amont du versioning\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les requ\u00eates.\n        \u2022Ajouter des param\u00e8tres aux routes dans les requ\u00eates.\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les r\u00e9ponses.\n        \u2022Ajouter des codes erreurs dans les r\u00e9ponses.\n        &amp;quot;&amp;quot;&amp;quot;\n&amp;gt;       raise NotImplementedError(&amp;quot;swagger compliance non test\u00e9&amp;quot;)\nE       NotImplementedError: swagger compliance non test\u00e9\n\ntest_openapi.py:18: NotImplementedError\n&#34;}], &#34;test_pac0.py::test_pac0_import_services&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_pac0.py::test_pac0_import_services&#34;, &#34;duration&#34;: &#34;23 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_pac0.py::test_pac0_import_services&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;23 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;+ Exception Group Traceback (most recent call last):\n  |   File &amp;quot;/home/philippe/src/PA_Communautaire/packages/pac-bdd/test_pac0.py&amp;quot;, line 21, in test_pac0_import_services\n  |     async with asyncio.TaskGroup() as tg:\n  |                ~~~~~~~~~~~~~~~~~^^\n  |   File &amp;quot;/home/philippe/.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/taskgroups.py&amp;quot;, line 71, in __aexit__\n  |     return await self._aexit(et, exc)\n  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  |   File &amp;quot;/home/philippe/.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/taskgroups.py&amp;quot;, line 173, in _aexit\n  |     raise BaseExceptionGroup(\n  |     ...&amp;lt;2 lines&amp;gt;...\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File &amp;quot;/home/philippe/src/PA_Communautaire/packages/pac-bdd/test_pac0.py&amp;quot;, line 22, in test_pac0_import_services\n    |     task1 = tg.create_task(api_gateway_main.app.run())\n    |                            ^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: &amp;#x27;FastAPI&amp;#x27; object has no attribute &amp;#x27;run&amp;#x27;\n    +------------------------------------\n\n------------------------------ Captured log setup ------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n\n----------------------------- Captured stdout call -----------------------------\nConnecting to NATS nats://localhost:4222 ...\nConnecting to NATS nats://localhost:4222 ...\nConnecting to NATS nats://localhost:4222 ...\n&#34;}], &#34;test_scenario.py::test_simpliste_avec_commentaire&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_simpliste_avec_commentaire&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_simpliste_avec_commentaire&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais quelque chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais quelque chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;ai fait 4 choses&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;ai fait {nb} choses&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_simpliste&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_simpliste&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_simpliste&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function it_works at 0x7a52a4d66840&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_simpliste&amp;gt;&amp;gt;, kwargs = {&amp;#x27;nb&amp;#x27;: &amp;#x27;4&amp;#x27;}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nnb = &amp;#x27;4&amp;#x27;\n\n    @then(parsers.parse(&amp;quot;&amp;quot;&amp;quot;j&amp;#x27;ai fait {nb} choses&amp;quot;&amp;quot;&amp;quot;))\n    def it_works(nb):\n        # si le nombre donn\u00e9e `nb` ne corresponds pas au contexte, on \u00e9choue\n&amp;gt;       assert ctx[&amp;#x27;nb&amp;#x27;] == int(nb)\n               ^^^^^^^^^^^^^^^^^^^^\nE       AssertionError\n\nsrc/pac_bdd/demo.py:31: AssertionError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais quelque chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais quelque chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;ai fait 4 choses&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;ai fait {nb} choses&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_trackingid_fourni&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_trackingid_fourni&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_trackingid_fourni&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 13 in scenario &amp;quot;trackingId fourni&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/trackingId.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\nxxxxxxxxxxxxxxxxxx world1\n_check_http_health http://localhost:8027/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8100 ...\n2026-01-14 16:25:32,422 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-14 16:25:32,422 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8100 ...\n2026-01-14 16:25:32,422 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 16:25:32,423 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8100 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8027\n    server   Documentation at http://0.0.0.0:8027/docs\n \n             Logs:\n \n2026-01-14 16:25:32,579 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 16:25:32,579 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8027/healthcheck\n      INFO   127.0.0.1:52956 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:52968 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[92060] 2026/01/14 16:25:32.091751 [INF] Starting nats-server\n[92060] 2026/01/14 16:25:32.091826 [INF]   Version:  2.12.3\n[92060] 2026/01/14 16:25:32.091832 [INF]   Git:      [450a519]\n[92060] 2026/01/14 16:25:32.091836 [INF]   Name:     NB7GSYLAYLKMRT4I7T7WBDTQXTCDOOY7VHNZFDTFZSH62PRTWWSJRZ7Z\n[92060] 2026/01/14 16:25:32.091839 [INF]   ID:       NB7GSYLAYLKMRT4I7T7WBDTQXTCDOOY7VHNZFDTFZSH62PRTWWSJRZ7Z\n[92060] 2026/01/14 16:25:32.092393 [INF] Listening for client connections on 0.0.0.0:8100\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[92060] 2026/01/14 16:25:32.092643 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 16:25:32,419 INFO     - FastStream app starting...\n2026-01-14 16:25:32,420 INFO     - FastStream app starting...\n2026-01-14 16:25:32,422 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 16:25:32,423 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [92075]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8027 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:135 Starting service peppol on port 8094 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  peppol started on localhost:8094\nINFO     pac0.shared.test.world:world.py:88 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service esb_central on port 8100 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  esb_central started on localhost:8100\nINFO     pac0.shared.test.service.base:base.py:135 Starting service api_gateway on port 8027 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service controle_formats on port 8176 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  controle_formats started on localhost:8176\nINFO     pac0.shared.test.service.base:base.py:135 Starting service routage on port 8038 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  routage started on localhost:8038\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8027 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8027 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x7a52a4aa6ba0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 15:25:32 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8027/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:161 Service  api_gateway started on localhost:8027\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8027 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x7a52a482c590&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 15:25:32 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8027/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [92075]\n2026-01-14 16:25:33,524 INFO     - FastStream app shutting down...\n2026-01-14 16:25:33,525 INFO     - FastStream app shut down gracefully.\n2026-01-14 16:25:33,723 INFO     - FastStream app shutting down...\n2026-01-14 16:25:33,724 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.world:world.py:96 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_trackingid_absent&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_trackingid_absent&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_trackingid_absent&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 23 in scenario &amp;quot;trackingId absent&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/trackingId.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\nxxxxxxxxxxxxxxxxxx world1\n_check_http_health http://localhost:8198/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8190 ...\n2026-01-14 16:25:34,463 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 16:25:34,463 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8190 ...\n2026-01-14 16:25:34,464 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-14 16:25:34,464 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8190 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8198\n    server   Documentation at http://0.0.0.0:8198/docs\n \n             Logs:\n \n2026-01-14 16:25:34,684 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 16:25:34,684 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8198/healthcheck\n      INFO   127.0.0.1:60424 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:60440 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[92121] 2026/01/14 16:25:33.899647 [INF] Starting nats-server\n[92121] 2026/01/14 16:25:33.899743 [INF]   Version:  2.12.3\n[92121] 2026/01/14 16:25:33.899749 [INF]   Git:      [450a519]\n[92121] 2026/01/14 16:25:33.899753 [INF]   Name:     NBE7YV3Y3NJDFMBKEDZVPM73AFPF32XHOPJJE5B6CKFA2JITLKBCYAD7\n[92121] 2026/01/14 16:25:33.899763 [INF]   ID:       NBE7YV3Y3NJDFMBKEDZVPM73AFPF32XHOPJJE5B6CKFA2JITLKBCYAD7\n[92121] 2026/01/14 16:25:33.900423 [INF] Listening for client connections on 0.0.0.0:8190\n[92121] 2026/01/14 16:25:33.900810 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 16:25:34,458 INFO     - FastStream app starting...\n2026-01-14 16:25:34,460 INFO     - FastStream app starting...\n2026-01-14 16:25:34,463 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 16:25:34,464 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [92140]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8198 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:135 Starting service peppol on port 8060 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  peppol started on localhost:8060\nINFO     pac0.shared.test.world:world.py:88 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service esb_central on port 8190 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  esb_central started on localhost:8190\nINFO     pac0.shared.test.service.base:base.py:135 Starting service api_gateway on port 8198 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service controle_formats on port 8189 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  controle_formats started on localhost:8189\nINFO     pac0.shared.test.service.base:base.py:135 Starting service routage on port 8119 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  routage started on localhost:8119\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8198 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8198 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x7a52a4826ad0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 15:25:34 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8198/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:161 Service  api_gateway started on localhost:8198\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8198 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x7a52a4844550&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 15:25:34 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8198/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [92140]\n2026-01-14 16:25:35,364 INFO     - FastStream app shutting down...\n2026-01-14 16:25:35,365 INFO     - FastStream app shut down gracefully.\n2026-01-14 16:25:35,566 INFO     - FastStream app shutting down...\n2026-01-14 16:25:35,568 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.world:world.py:96 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_trackingid_doublon&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_trackingid_doublon&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_trackingid_doublon&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 32 in scenario &amp;quot;trackingId doublon&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/trackingId.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\nxxxxxxxxxxxxxxxxxx world1\n_check_http_health http://localhost:8007/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8129 ...\n2026-01-14 16:25:36,258 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 16:25:36,259 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8129 ...\n2026-01-14 16:25:36,287 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-14 16:25:36,287 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8129 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8007\n    server   Documentation at http://0.0.0.0:8007/docs\n \n             Logs:\n \n2026-01-14 16:25:36,490 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 16:25:36,490 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8007/healthcheck\n      INFO   127.0.0.1:52388 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:52404 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[92179] 2026/01/14 16:25:35.710410 [INF] Starting nats-server\n[92179] 2026/01/14 16:25:35.710509 [INF]   Version:  2.12.3\n[92179] 2026/01/14 16:25:35.710514 [INF]   Git:      [450a519]\n[92179] 2026/01/14 16:25:35.710518 [INF]   Name:     ND3E6PB3ZJN4AUPRL4ULPGKTMJ47HDQ7IATOFZJCXT4XHW54VP3YCV36\n[92179] 2026/01/14 16:25:35.710529 [INF]   ID:       ND3E6PB3ZJN4AUPRL4ULPGKTMJ47HDQ7IATOFZJCXT4XHW54VP3YCV36\n[92179] 2026/01/14 16:25:35.711301 [INF] Listening for client connections on 0.0.0.0:8129\n[92179] 2026/01/14 16:25:35.711728 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 16:25:36,254 INFO     - FastStream app starting...\n2026-01-14 16:25:36,259 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 16:25:36,283 INFO     - FastStream app starting...\n2026-01-14 16:25:36,287 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [92195]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8007 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:135 Starting service peppol on port 8103 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  peppol started on localhost:8103\nINFO     pac0.shared.test.world:world.py:88 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service esb_central on port 8129 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  esb_central started on localhost:8129\nINFO     pac0.shared.test.service.base:base.py:135 Starting service api_gateway on port 8007 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service controle_formats on port 8054 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  controle_formats started on localhost:8054\nINFO     pac0.shared.test.service.base:base.py:135 Starting service routage on port 8057 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  routage started on localhost:8057\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8007 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8007 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x7a52a4827c50&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 15:25:36 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8007/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:161 Service  api_gateway started on localhost:8007\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8007 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x7a52a4826990&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 15:25:36 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8007/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [92195]\n2026-01-14 16:25:37,057 INFO     - FastStream app shutting down...\n2026-01-14 16:25:37,059 INFO     - FastStream app shut down gracefully.\n2026-01-14 16:25:37,186 INFO     - FastStream app shutting down...\n2026-01-14 16:25:37,187 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.world:world.py:96 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_api_gateway&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_api_gateway&#34;, &#34;duration&#34;: &#34;00:00:01&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marragearr\u00eat_service_api_gateway&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:01&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:8144/healthcheck\ncccccc All connection attempts failed\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8119 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8144\n    server   Documentation at http://0.0.0.0:8144/docs\n \n             Logs:\n \n2026-01-14 16:25:38,162 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 16:25:38,162 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8144/healthcheck\n      INFO   127.0.0.1:48362 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[92228] 2026/01/14 16:25:37.341893 [INF] Starting nats-server\n[92228] 2026/01/14 16:25:37.341981 [INF]   Version:  2.12.3\n[92228] 2026/01/14 16:25:37.341986 [INF]   Git:      [450a519]\n[92228] 2026/01/14 16:25:37.341991 [INF]   Name:     ND27GUBXOLHKCOQDMKREW43QSXAIGZREXQYB4OASXCJSDQQYITCUYYTP\n[92228] 2026/01/14 16:25:37.341997 [INF]   ID:       ND27GUBXOLHKCOQDMKREW43QSXAIGZREXQYB4OASXCJSDQQYITCUYYTP\n[92228] 2026/01/14 16:25:37.342736 [INF] Listening for client connections on 0.0.0.0:8119\n[92228] 2026/01/14 16:25:37.343176 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n      INFO   Started server process [92240]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8144 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:135 Starting service None on port 8119 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready None ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  None started on localhost:8119\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;01-api-gateway&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;01-api-gateway&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je lance le service &amp;quot;01-api-gateway&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je lance le service &amp;quot;01-api-gateway&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nINFO     pac0.shared.test.service.base:base.py:135 Starting service api_gateway on port 8144 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8144 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8144 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x7a52a4a635c0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 15:25:38 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8144/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:161 Service  api_gateway started on localhost:8144\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;01-api-gateway&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;01-api-gateway&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [92240]\n[92228] 2026/01/14 16:25:38.643129 [INF] Trapped &amp;quot;terminated&amp;quot; signal\n[92228] 2026/01/14 16:25:38.643338 [INF] Initiating Shutdown...\n[92228] 2026/01/14 16:25:38.643482 [INF] Server Exiting..\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...&#34;}], &#34;test_scenario.py::test_contr\u00f4le_sha256&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_contr\u00f4le_sha256&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_contr\u00f4le_sha256&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 9 in scenario &amp;quot;Contr\u00f4le sha256&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/sha256.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\nxxxxxxxxxxxxxxxxxx world1\n_check_http_health http://localhost:8194/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8155 ...\n2026-01-14 16:25:39,217 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 16:25:39,217 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8155 ...\n2026-01-14 16:25:39,236 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-14 16:25:39,236 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8155 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8194\n    server   Documentation at http://0.0.0.0:8194/docs\n \n             Logs:\n \n2026-01-14 16:25:39,457 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 16:25:39,458 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8194/healthcheck\n      INFO   127.0.0.1:50346 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:50362 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[92263] 2026/01/14 16:25:38.657523 [INF] Starting nats-server\n[92263] 2026/01/14 16:25:38.657594 [INF]   Version:  2.12.3\n[92263] 2026/01/14 16:25:38.657599 [INF]   Git:      [450a519]\n[92263] 2026/01/14 16:25:38.657603 [INF]   Name:     NBGHE57YUSGTRTFV3RAZAZCIWJL52MW7U75AEPC2VK4CYPLOUYGVIJLL\n[92263] 2026/01/14 16:25:38.657607 [INF]   ID:       NBGHE57YUSGTRTFV3RAZAZCIWJL52MW7U75AEPC2VK4CYPLOUYGVIJLL\n[92263] 2026/01/14 16:25:38.658337 [INF] Listening for client connections on 0.0.0.0:8155\n[92263] 2026/01/14 16:25:38.658751 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 16:25:39,212 INFO     - FastStream app starting...\n2026-01-14 16:25:39,217 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 16:25:39,232 INFO     - FastStream app starting...\n2026-01-14 16:25:39,237 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [92283]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8194 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:135 Starting service peppol on port 8062 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  peppol started on localhost:8062\nINFO     pac0.shared.test.world:world.py:88 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service esb_central on port 8155 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  esb_central started on localhost:8155\nINFO     pac0.shared.test.service.base:base.py:135 Starting service api_gateway on port 8194 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service controle_formats on port 8103 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  controle_formats started on localhost:8103\nINFO     pac0.shared.test.service.base:base.py:135 Starting service routage on port 8133 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  routage started on localhost:8133\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8194 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8194 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x7a52a483e2c0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 15:25:39 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8194/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:161 Service  api_gateway started on localhost:8194\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8194 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x7a52a483ce90&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 15:25:39 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8194/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [92283]\n2026-01-14 16:25:40,115 INFO     - FastStream app shutting down...\n2026-01-14 16:25:40,117 INFO     - FastStream app shut down gracefully.\n2026-01-14 16:25:40,337 INFO     - FastStream app shutting down...\n2026-01-14 16:25:40,339 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.world:world.py:96 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_healthcheck&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_healthcheck&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_healthcheck&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\nxxxxxxxxxxxxxxxxxx world1\n_check_http_health http://localhost:8178/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8040 ...\n2026-01-14 16:25:41,039 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 16:25:41,040 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8040 ...\n2026-01-14 16:25:41,051 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-14 16:25:41,052 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8040 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8178\n    server   Documentation at http://0.0.0.0:8178/docs\n \n             Logs:\n \n2026-01-14 16:25:41,261 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 16:25:41,261 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8178/healthcheck\n      INFO   127.0.0.1:51946 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:51960 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[92313] 2026/01/14 16:25:40.470717 [INF] Starting nats-server\n[92313] 2026/01/14 16:25:40.470793 [INF]   Version:  2.12.3\n[92313] 2026/01/14 16:25:40.470798 [INF]   Git:      [450a519]\n[92313] 2026/01/14 16:25:40.470802 [INF]   Name:     NDBY6U7CK7YXVPETNA4BXGXHPVIMSNN2YXLVDLQO62CIU5B25EJYT2FD\n[92313] 2026/01/14 16:25:40.470807 [INF]   ID:       NDBY6U7CK7YXVPETNA4BXGXHPVIMSNN2YXLVDLQO62CIU5B25EJYT2FD\n[92313] 2026/01/14 16:25:40.471325 [INF] Listening for client connections on 0.0.0.0:8040\n[92313] 2026/01/14 16:25:40.471754 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 16:25:41,035 INFO     - FastStream app starting...\n2026-01-14 16:25:41,040 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 16:25:41,047 INFO     - FastStream app starting...\n2026-01-14 16:25:41,052 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [92332]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8178 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_une pa communautaire&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_une pa communautaire&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:135 Starting service peppol on port 8139 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  peppol started on localhost:8139\nINFO     pac0.shared.test.world:world.py:88 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service esb_central on port 8040 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  esb_central started on localhost:8040\nINFO     pac0.shared.test.service.base:base.py:135 Starting service api_gateway on port 8178 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service controle_formats on port 8002 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  controle_formats started on localhost:8002\nINFO     pac0.shared.test.service.base:base.py:135 Starting service routage on port 8136 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  routage started on localhost:8136\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8178 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8178 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x7a52a4850dd0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 15:25:41 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8178/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:161 Service  api_gateway started on localhost:8178\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API GET /healthcheck&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8178 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x7a52a483efd0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 15:25:41 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8178/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;obtiens le code de retour 200&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;obtiens le code de retour {code}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [92332]\n2026-01-14 16:25:41,837 INFO     - FastStream app shutting down...\n2026-01-14 16:25:41,839 INFO     - FastStream app shut down gracefully.\n2026-01-14 16:25:42,051 INFO     - FastStream app shutting down...\n2026-01-14 16:25:42,053 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.world:world.py:96 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_healthcheck_deep&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_healthcheck_deep&#34;, &#34;duration&#34;: &#34;00:00:04&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_healthcheck_deep&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:04&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\nxxxxxxxxxxxxxxxxxx world1\n_check_http_health http://localhost:8189/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8007 ...\n2026-01-14 16:25:42,762 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 16:25:42,763 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8007 ...\n2026-01-14 16:25:42,768 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-14 16:25:42,768 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8007 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8189\n    server   Documentation at http://0.0.0.0:8189/docs\n \n             Logs:\n \n2026-01-14 16:25:43,011 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 16:25:43,012 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8189/healthcheck\n      INFO   127.0.0.1:35014 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n2026-01-14 16:25:43,377 INFO     - healthcheck      | dc034d66-3 - Received\n2026-01-14 16:25:43,377 INFO     -   | healthcheck         | dc034d66-3 - Received\n2026-01-14 16:25:43,377 INFO     -   | healthcheck | dc034d66-3 - Received\n2026-01-14 16:25:43,377 INFO     - healthcheck      | dc034d66-3 - Processed\n2026-01-14 16:25:43,377 INFO     -   | healthcheck         | dc034d66-3 - Processed\n2026-01-14 16:25:43,377 INFO     -   | healthcheck | dc034d66-3 - Processed\n2026-01-14 16:25:43,378 INFO     - healthcheck_resp | 7427ec3d-8 - Received\n2026-01-14 16:25:43,378 INFO     - healthcheck_resp | 7427ec3d-8 - Processed\n2026-01-14 16:25:43,379 INFO     - healthcheck_resp | 3269f050-f - Received\n2026-01-14 16:25:43,379 INFO     - healthcheck_resp | 3269f050-f - Processed\n2026-01-14 16:25:43,379 INFO     - healthcheck_resp | a91f9210-d - Received\n2026-01-14 16:25:43,379 INFO     - healthcheck_resp | a91f9210-d - Processed\n      INFO   127.0.0.1:35018 - &amp;quot;GET /healthcheck/deep HTTP/1.1&amp;quot; 200\ncccccc 3 3\n\n----------------------------- Captured stderr call -----------------------------\n[92370] 2026/01/14 16:25:42.207267 [INF] Starting nats-server\n[92370] 2026/01/14 16:25:42.207387 [INF]   Version:  2.12.3\n[92370] 2026/01/14 16:25:42.207395 [INF]   Git:      [450a519]\n[92370] 2026/01/14 16:25:42.207399 [INF]   Name:     NABFEK6BPHZR5XTCFSPGI5JLUC4HYGBQUOXFZ7VS36PFBMLRLIBETGCB\n[92370] 2026/01/14 16:25:42.207410 [INF]   ID:       NABFEK6BPHZR5XTCFSPGI5JLUC4HYGBQUOXFZ7VS36PFBMLRLIBETGCB\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[92370] 2026/01/14 16:25:42.208063 [INF] Listening for client connections on 0.0.0.0:8007\n[92370] 2026/01/14 16:25:42.208516 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 16:25:42,758 INFO     - FastStream app starting...\n2026-01-14 16:25:42,763 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 16:25:42,764 INFO     - FastStream app starting...\n2026-01-14 16:25:42,768 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [92387]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8189 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_une pa communautaire&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_une pa communautaire&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:135 Starting service peppol on port 8094 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  peppol started on localhost:8094\nINFO     pac0.shared.test.world:world.py:88 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service esb_central on port 8007 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  esb_central started on localhost:8007\nINFO     pac0.shared.test.service.base:base.py:135 Starting service api_gateway on port 8189 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service controle_formats on port 8019 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  controle_formats started on localhost:8019\nINFO     pac0.shared.test.service.base:base.py:135 Starting service routage on port 8153 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  routage started on localhost:8153\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8189 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8189 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x7a52a4ae2690&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 15:25:43 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8189/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:161 Service  api_gateway started on localhost:8189\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API GET /healthcheck/deep&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8189 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x7a52a4aca7b0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 15:25:43 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;64&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8189/healthcheck/deep &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;obtiens le code de retour 200&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;obtiens le code de retour {code}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_la r\u00e9ponse a une cl\u00e9 &amp;quot;healthcheck_resp&amp;quot; avec 3 \u00e9l\u00e9ments&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_la r\u00e9ponse a une cl\u00e9 &amp;quot;{key}&amp;quot; avec {nb} \u00e9l\u00e9ments&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [92387]\n2026-01-14 16:25:45,569 INFO     - FastStream app shutting down...\n2026-01-14 16:25:45,570 INFO     - FastStream app shut down gracefully.\n2026-01-14 16:25:45,675 INFO     - FastStream app shutting down...\n2026-01-14 16:25:45,676 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.world:world.py:96 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_controle_format_facturx&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_controle_format_facturx&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_controle_format_facturx&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function control_invoice at 0x7a52a4d89800&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_controle_format_facturx&amp;gt;&amp;gt;, kwargs = {}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\n    @when(\n        parsers.parse(&amp;quot;je d\u00e9pose pour contr\u00f4le la facture @{invoice}&amp;quot;),\n    )\n    def control_invoice():\n&amp;gt;       raise NotImplementedError()\nE       NotImplementedError\n\nsrc/pac_bdd/tobeimplemented.py:30: NotImplementedError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je d\u00e9pose pour contr\u00f4le la facture @FA213746_20251211_124749.pdf&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je d\u00e9pose pour contr\u00f4le la facture @{invoice}&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_serveur_nats&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_serveur_nats&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_serveur_nats&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un serveur NATS disponible&amp;quot;. Line 19 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un serveur NATS&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/service_lifecycle.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_connexion_dun_broker_au_serveur_nats&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_connexion_dun_broker_au_serveur_nats&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_connexion_dun_broker_au_serveur_nats&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un serveur NATS disponible&amp;quot;. Line 23 in scenario &amp;quot;Connexion d&amp;#x27;un broker au serveur NATS&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/service_lifecycle.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_de_plusieurs_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_de_plusieurs_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_de_plusieurs_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;2 PA d\u00e9marr\u00e9es&amp;quot;. Line 32 in scenario &amp;quot;D\u00e9marrage de plusieurs PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/service_lifecycle.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_service_nats_local&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_service_nats_local&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_service_nats_local&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service NATS local&amp;quot;. Line 21 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un service NATS local&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_connexion_\u00e0_un_service_nats_distant&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_connexion_\u00e0_un_service_nats_distant&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_connexion_\u00e0_un_service_nats_distant&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service NATS local comme r\u00e9f\u00e9rence&amp;quot;. Line 27 in scenario &amp;quot;Connexion \u00e0 un service NATS distant&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_service_peppol_mock&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_service_peppol_mock&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_service_peppol_mock&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock&amp;quot;. Line 33 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un service Peppol mock&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_configuration_des_r\u00e9ponses_peppol_mock&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_configuration_des_r\u00e9ponses_peppol_mock&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_configuration_des_r\u00e9ponses_peppol_mock&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock&amp;quot;. Line 38 in scenario &amp;quot;Configuration des r\u00e9ponses Peppol mock&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_recherche_peppol_dune_entreprise_non_enregistr\u00e9e&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_recherche_peppol_dune_entreprise_non_enregistr\u00e9e&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_recherche_peppol_dune_entreprise_non_enregistr\u00e9e&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock&amp;quot;. Line 45 in scenario &amp;quot;Recherche Peppol d&amp;#x27;une entreprise non enregistr\u00e9e&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_service_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_service_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_service_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service PA&amp;quot;. Line 51 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un service PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_1_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_1_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_1_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 1 PA&amp;quot;. Line 61 in scenario &amp;quot;Cr\u00e9ation d&amp;#x27;un monde avec 1 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_2_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_2_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_2_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 68 in scenario &amp;quot;Cr\u00e9ation d&amp;#x27;un monde avec 2 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_4_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_4_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_4_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 4 PA&amp;quot;. Line 74 in scenario &amp;quot;Cr\u00e9ation d&amp;#x27;un monde avec 4 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_les_pa_partagent_le_m\u00eame_service_nats&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_les_pa_partagent_le_m\u00eame_service_nats&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_les_pa_partagent_le_m\u00eame_service_nats&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 82 in scenario &amp;quot;Les PA partagent le m\u00eame service NATS&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_les_pa_ont_des_ports_api_distincts&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_les_pa_ont_des_ports_api_distincts&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_les_pa_ont_des_ports_api_distincts&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 3 PA&amp;quot;. Line 87 in scenario &amp;quot;Les PA ont des ports API distincts&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_toutes_les_pa_r\u00e9pondent_au_healthcheck&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_toutes_les_pa_r\u00e9pondent_au_healthcheck&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_toutes_les_pa_r\u00e9pondent_au_healthcheck&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 95 in scenario &amp;quot;Toutes les PA r\u00e9pondent au healthcheck&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_information_du_monde&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_information_du_monde&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_information_du_monde&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 104 in scenario &amp;quot;Information du monde&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_arr\u00eat_propre_du_monde&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_arr\u00eat_propre_du_monde&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_arr\u00eat_propre_du_monde&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA d\u00e9marr\u00e9&amp;quot;. Line 115 in scenario &amp;quot;Arr\u00eat propre du monde&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_monde_avec_nats_externe&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_monde_avec_nats_externe&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_monde_avec_nats_externe&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service NATS local comme r\u00e9f\u00e9rence&amp;quot;. Line 126 in scenario &amp;quot;Monde avec NATS externe&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_monde_avec_peppol_personnalis\u00e9&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_monde_avec_peppol_personnalis\u00e9&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_monde_avec_peppol_personnalis\u00e9&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock comme r\u00e9f\u00e9rence&amp;quot;. Line 132 in scenario &amp;quot;Monde avec Peppol personnalis\u00e9&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9p\u00f4t_de_facture_entre_2_pa_via_peppol&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9p\u00f4t_de_facture_entre_2_pa_via_peppol&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9p\u00f4t_de_facture_entre_2_pa_via_peppol&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 141 in scenario &amp;quot;D\u00e9p\u00f4t de facture entre 2 PA via Peppol&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_esb_central&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_esb_central&#34;, &#34;duration&#34;: &#34;5 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marragearr\u00eat_service_esb_central&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;5 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_le service &amp;quot;02-esb-central&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_le service &amp;quot;02-esb-central&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:135 Starting service None on port 8101 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready None ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  None started on localhost:8101\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...&#34;}], &#34;test_scenario.py::test_healthcheck_message&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_healthcheck_message&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_healthcheck_message&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function esb_sub at 0x7a52a4d889a0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_healthcheck_message&amp;gt;&amp;gt;\nkwargs = {&amp;#x27;canal&amp;#x27;: &amp;#x27;healthcheck&amp;#x27;, &amp;#x27;world1&amp;#x27;: WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x7a5...tream.FastStreamServiceContext object at 0x7a52a4835d30&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x7a52a4bf77d0&amp;gt;)])}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nsrc/pac_bdd/esb.py:19: in wrapper\n    return asyncio.run(fn(*args, **kwargs))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/runners.py:195: in run\n    return runner.run(main)\n           ^^^^^^^^^^^^^^^^\n../../../../.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/runners.py:118: in run\n    return self._loop.run_until_complete(task)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/base_events.py:725: in run_until_complete\n    return future.result()\n           ^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nworld1 = WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x7a52a481bdf0&amp;gt;, pas=[PacServiceContext(...stream.FastStreamServiceContext object at 0x7a52a4835d30&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x7a52a4bf77d0&amp;gt;)])\ncanal = &amp;#x27;healthcheck&amp;#x27;\n\n    @when(\n        parsers.parse(&amp;quot;j&amp;#x27;\u00e9coute le canal &amp;#x27;{canal}&amp;#x27;&amp;quot;),\n    )\n    @async_to_sync\n    async def esb_sub(\n        world1: WorldContext,\n        canal: str,\n    ):\n        global handle_GLOBAL\n    \n        print(f&amp;quot;esb_sub {canal=}...&amp;quot;)\n        #raise NotImplementedError()\n&amp;gt;       broker = world1.pa.broker\n                 ^^^^^^^^^^^^^^^^\nE       AttributeError: &amp;#x27;PacServiceContext&amp;#x27; object has no attribute &amp;#x27;broker&amp;#x27;\n\nsrc/pac_bdd/esb.py:39: AttributeError\n\n----------------------------- Captured stdout call -----------------------------\nxxxxxxxxxxxxxxxxxx world1\n_check_http_health http://localhost:8144/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8114 ...\n2026-01-14 16:25:46,415 INFO     - q | routage-IN  |            - `Process` waiting for messages\nConnecting to NATS nats://localhost:8114 ...\n2026-01-14 16:25:46,415 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 16:25:46,416 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\n2026-01-14 16:25:46,416 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8114 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8144\n    server   Documentation at http://0.0.0.0:8144/docs\n \n             Logs:\n \n2026-01-14 16:25:46,639 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 16:25:46,639 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8144/healthcheck\n      INFO   127.0.0.1:55594 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\nesb_sub canal=&amp;#x27;healthcheck&amp;#x27;...\n\n----------------------------- Captured stderr call -----------------------------\n[92444] 2026/01/14 16:25:45.878877 [INF] Starting nats-server\n[92444] 2026/01/14 16:25:45.878971 [INF]   Version:  2.12.3\n[92444] 2026/01/14 16:25:45.878976 [INF]   Git:      [450a519]\n[92444] 2026/01/14 16:25:45.878981 [INF]   Name:     NBFB3MFYXSEIHTQSXWFGIQI2FTDM7E2JGBB2RBQ5GMGQQGXO7RKV2PBI\n[92444] 2026/01/14 16:25:45.878994 [INF]   ID:       NBFB3MFYXSEIHTQSXWFGIQI2FTDM7E2JGBB2RBQ5GMGQQGXO7RKV2PBI\n[92444] 2026/01/14 16:25:45.879850 [INF] Listening for client connections on 0.0.0.0:8114\n[92444] 2026/01/14 16:25:45.880317 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 16:25:46,410 INFO     - FastStream app starting...\n2026-01-14 16:25:46,412 INFO     - FastStream app starting...\n2026-01-14 16:25:46,416 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 16:25:46,416 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [92463]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8144 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;\u00e9coute le canal &amp;#x27;healthcheck&amp;#x27;&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;\u00e9coute le canal &amp;#x27;{canal}&amp;#x27;&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:135 Starting service peppol on port 8055 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  peppol started on localhost:8055\nINFO     pac0.shared.test.world:world.py:88 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service esb_central on port 8114 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  esb_central started on localhost:8114\nINFO     pac0.shared.test.service.base:base.py:135 Starting service api_gateway on port 8144 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service controle_formats on port 8101 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  controle_formats started on localhost:8101\nINFO     pac0.shared.test.service.base:base.py:135 Starting service routage on port 8106 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  routage started on localhost:8106\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8144 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8144 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x7a52a4ae3790&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 15:25:46 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8144/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:161 Service  api_gateway started on localhost:8144\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [92463]\n2026-01-14 16:25:47,312 INFO     - FastStream app shutting down...\n2026-01-14 16:25:47,314 INFO     - FastStream app shut down gracefully.\n2026-01-14 16:25:47,514 INFO     - FastStream app shutting down...\n2026-01-14 16:25:47,515 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.world:world.py:96 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_canal_pingpong&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_canal_pingpong&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_canal_pingpong&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function esb_sub at 0x7a52a4d889a0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_canal_pingpong&amp;gt;&amp;gt;\nkwargs = {&amp;#x27;canal&amp;#x27;: &amp;#x27;pong&amp;#x27;, &amp;#x27;world1&amp;#x27;: WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x7a52a4ae2b...tream.FastStreamServiceContext object at 0x7a52a4bf7890&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x7a52a4bf4650&amp;gt;)])}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nsrc/pac_bdd/esb.py:19: in wrapper\n    return asyncio.run(fn(*args, **kwargs))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/runners.py:195: in run\n    return runner.run(main)\n           ^^^^^^^^^^^^^^^^\n../../../../.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/runners.py:118: in run\n    return self._loop.run_until_complete(task)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/base_events.py:725: in run_until_complete\n    return future.result()\n           ^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nworld1 = WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x7a52a4ae2be0&amp;gt;, pas=[PacServiceContext(...stream.FastStreamServiceContext object at 0x7a52a4bf7890&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x7a52a4bf4650&amp;gt;)])\ncanal = &amp;#x27;pong&amp;#x27;\n\n    @when(\n        parsers.parse(&amp;quot;j&amp;#x27;\u00e9coute le canal &amp;#x27;{canal}&amp;#x27;&amp;quot;),\n    )\n    @async_to_sync\n    async def esb_sub(\n        world1: WorldContext,\n        canal: str,\n    ):\n        global handle_GLOBAL\n    \n        print(f&amp;quot;esb_sub {canal=}...&amp;quot;)\n        #raise NotImplementedError()\n&amp;gt;       broker = world1.pa.broker\n                 ^^^^^^^^^^^^^^^^\nE       AttributeError: &amp;#x27;PacServiceContext&amp;#x27; object has no attribute &amp;#x27;broker&amp;#x27;\n\nsrc/pac_bdd/esb.py:39: AttributeError\n\n----------------------------- Captured stdout call -----------------------------\nxxxxxxxxxxxxxxxxxx world1\n_check_http_health http://localhost:8157/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8138 ...\n2026-01-14 16:25:48,249 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 16:25:48,249 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8138 ...\n2026-01-14 16:25:48,259 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-14 16:25:48,260 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8138 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8157\n    server   Documentation at http://0.0.0.0:8157/docs\n \n             Logs:\n \n2026-01-14 16:25:48,467 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 16:25:48,467 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8157/healthcheck\n      INFO   127.0.0.1:47260 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\nesb_sub canal=&amp;#x27;pong&amp;#x27;...\n\n----------------------------- Captured stderr call -----------------------------\n[92503] 2026/01/14 16:25:47.683143 [INF] Starting nats-server\n[92503] 2026/01/14 16:25:47.683223 [INF]   Version:  2.12.3\n[92503] 2026/01/14 16:25:47.683228 [INF]   Git:      [450a519]\n[92503] 2026/01/14 16:25:47.683233 [INF]   Name:     ND2HEAFXHBTNC6ZNQ5DHZVXKC4JOUQGVW4T47DVN65C6APCMJJXEJSAK\n[92503] 2026/01/14 16:25:47.683236 [INF]   ID:       ND2HEAFXHBTNC6ZNQ5DHZVXKC4JOUQGVW4T47DVN65C6APCMJJXEJSAK\n[92503] 2026/01/14 16:25:47.683973 [INF] Listening for client connections on 0.0.0.0:8138\n[92503] 2026/01/14 16:25:47.684397 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 16:25:48,245 INFO     - FastStream app starting...\n2026-01-14 16:25:48,249 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 16:25:48,255 INFO     - FastStream app starting...\n2026-01-14 16:25:48,260 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [92519]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8157 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;\u00e9coute le canal &amp;#x27;pong&amp;#x27;&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;\u00e9coute le canal &amp;#x27;{canal}&amp;#x27;&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:135 Starting service peppol on port 8031 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  peppol started on localhost:8031\nINFO     pac0.shared.test.world:world.py:88 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service esb_central on port 8138 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  esb_central started on localhost:8138\nINFO     pac0.shared.test.service.base:base.py:135 Starting service api_gateway on port 8157 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:135 Starting service controle_formats on port 8173 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  controle_formats started on localhost:8173\nINFO     pac0.shared.test.service.base:base.py:135 Starting service routage on port 8058 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  routage started on localhost:8058\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8157 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8157 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x7a52a4a5a750&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 15:25:48 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8157/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:161 Service  api_gateway started on localhost:8157\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [92519]\n2026-01-14 16:25:49,147 INFO     - FastStream app shutting down...\n2026-01-14 16:25:49,148 INFO     - FastStream app shut down gracefully.\n2026-01-14 16:25:49,358 INFO     - FastStream app shutting down...\n2026-01-14 16:25:49,360 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.world:world.py:96 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;la PA #pa1&amp;quot;. Line 7 in scenario &amp;quot;2 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/pa_multiple.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_r\u00e9solution_sml_r\u00e9ussie_pour_un_participant_enregistr\u00e9&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_r\u00e9solution_sml_r\u00e9ussie_pour_un_participant_enregistr\u00e9&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_r\u00e9solution_sml_r\u00e9ussie_pour_un_participant_enregistr\u00e9&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;R\u00e9solution SML r\u00e9ussie pour un participant enregistr\u00e9&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_r\u00e9solution_sml_\u00e9chou\u00e9e__participant_non_enregistr\u00e9&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_r\u00e9solution_sml_\u00e9chou\u00e9e__participant_non_enregistr\u00e9&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_r\u00e9solution_sml_\u00e9chou\u00e9e__participant_non_enregistr\u00e9&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;R\u00e9solution SML \u00e9chou\u00e9e - participant non enregistr\u00e9&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_r\u00e9cup\u00e9ration_m\u00e9tadonn\u00e9es_smp_r\u00e9ussie&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_r\u00e9cup\u00e9ration_m\u00e9tadonn\u00e9es_smp_r\u00e9ussie&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_r\u00e9cup\u00e9ration_m\u00e9tadonn\u00e9es_smp_r\u00e9ussie&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;R\u00e9cup\u00e9ration m\u00e9tadonn\u00e9es SMP r\u00e9ussie&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_smp_ne_supporte_pas_le_document_type_demand\u00e9&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_smp_ne_supporte_pas_le_document_type_demand\u00e9&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_smp_ne_supporte_pas_le_document_type_demand\u00e9&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;SMP ne supporte pas le document type demand\u00e9&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_lookup_peppol_complet_r\u00e9ussi_par_siren&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_lookup_peppol_complet_r\u00e9ussi_par_siren&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_lookup_peppol_complet_r\u00e9ussi_par_siren&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Lookup PEPPOL complet r\u00e9ussi par SIREN&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_lookup_peppol_complet_r\u00e9ussi_par_siret&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_lookup_peppol_complet_r\u00e9ussi_par_siret&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_lookup_peppol_complet_r\u00e9ussi_par_siret&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Lookup PEPPOL complet r\u00e9ussi par SIRET&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_lookup_peppol_\u00e9chou\u00e9__participant_introuvable&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_lookup_peppol_\u00e9chou\u00e9__participant_introuvable&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_lookup_peppol_\u00e9chou\u00e9__participant_introuvable&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Lookup PEPPOL \u00e9chou\u00e9 - participant introuvable&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_routage_facture_vers_pa_distante_via_peppol&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_routage_facture_vers_pa_distante_via_peppol&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_routage_facture_vers_pa_distante_via_peppol&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Routage facture vers PA distante via PEPPOL&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_routage_facture__destinataire_local_pas_de_lookup_peppol&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_routage_facture__destinataire_local_pas_de_lookup_peppol&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_routage_facture__destinataire_local_pas_de_lookup_peppol&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Routage facture - destinataire local (pas de lookup PEPPOL)&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_routage_facture__fallback_vers_ppf&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_routage_facture__fallback_vers_ppf&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_routage_facture__fallback_vers_ppf&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Routage facture - fallback vers PPF&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_validation_du_certificat_peppol&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_validation_du_certificat_peppol&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_validation_du_certificat_peppol&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Validation du certificat PEPPOL&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_v\u00e9rification_de_la_signature_smp&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_v\u00e9rification_de_la_signature_smp&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_v\u00e9rification_de_la_signature_smp&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;V\u00e9rification de la signature SMP&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_v\u00e9rification_des_document_types_support\u00e9s&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_v\u00e9rification_des_document_types_support\u00e9s&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_v\u00e9rification_des_document_types_support\u00e9s&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;V\u00e9rification des document types support\u00e9s&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_timeout_lors_du_lookup_sml&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_timeout_lors_du_lookup_sml&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_timeout_lors_du_lookup_sml&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Timeout lors du lookup SML&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_smp_temporairement_indisponible&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_smp_temporairement_indisponible&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_smp_temporairement_indisponible&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;SMP temporairement indisponible&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_retry_automatique_apr\u00e8s_\u00e9chec_temporaire&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_retry_automatique_apr\u00e8s_\u00e9chec_temporaire&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_retry_automatique_apr\u00e8s_\u00e9chec_temporaire&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Retry automatique apr\u00e8s \u00e9chec temporaire&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_\u00e9chec_d\u00e9finitif_apr\u00e8s_plusieurs_retries&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_\u00e9chec_d\u00e9finitif_apr\u00e8s_plusieurs_retries&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_\u00e9chec_d\u00e9finitif_apr\u00e8s_plusieurs_retries&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;\u00c9chec d\u00e9finitif apr\u00e8s plusieurs retries&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_communication_bidirectionnelle_entre_2_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_communication_bidirectionnelle_entre_2_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_communication_bidirectionnelle_entre_2_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Communication bidirectionnelle entre 2 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_r\u00e9ception_dune_facture_via_as4_depuis_une_pa_distante&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_r\u00e9ception_dune_facture_via_as4_depuis_une_pa_distante&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_r\u00e9ception_dune_facture_via_as4_depuis_une_pa_distante&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;R\u00e9ception d&amp;#x27;une facture via AS4 depuis une PA distante&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_facture_b2g_via_chorus_pro_peppol&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_facture_b2g_via_chorus_pro_peppol&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_facture_b2g_via_chorus_pro_peppol&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Facture B2G via Chorus Pro PEPPOL&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_peppol_req&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_peppol_req&#34;, &#34;duration&#34;: &#34;7 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_peppol_req&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;7 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_le service PEPPOL simul\u00e9 avec:&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_le service PEPPOL simul\u00e9 avec:&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:135 Starting service peppol on port 8140 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:190 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:161 Service  peppol started on localhost:8140\nINFO     pac0.shared.test.world:world.py:88 WorldContext: enter context ...\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:173 Stopping service...\nINFO     pac0.shared.test.world:world.py:96 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_md5&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_md5&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_md5&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function check_result at 0x7a52a4dfbe20&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_md5&amp;gt;&amp;gt;\nkwargs = {&amp;#x27;peppol_context&amp;#x27;: PeppolContext(sml_zone=&amp;#x27;acc.edelivery.tech.ec.europa.eu&amp;#x27;, enterprise_id=None, siren=None, siret=None, result=&amp;#x27;b881aaeff8eeaed7190491ccdeaa42fc&amp;#x27;), &amp;#x27;result&amp;#x27;: &amp;#x27;6c2675d749449f2c8af1216fd866bb54&amp;#x27;}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\npeppol_context = PeppolContext(sml_zone=&amp;#x27;acc.edelivery.tech.ec.europa.eu&amp;#x27;, enterprise_id=None, siren=None, siret=None, result=&amp;#x27;b881aaeff8eeaed7190491ccdeaa42fc&amp;#x27;), result = &amp;#x27;6c2675d749449f2c8af1216fd866bb54&amp;#x27;\n\n    @then(parsers.parse(&amp;#x27;&amp;#x27;&amp;#x27;j&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27;&amp;#x27;&amp;#x27;))\n    def check_result(\n        peppol_context: PeppolContext,\n        result: str,\n    ):\n        &amp;quot;&amp;quot;&amp;quot;\u00e9tape g\u00e9n\u00e9rique pour tester tout r\u00e9sultat&amp;quot;&amp;quot;&amp;quot;\n        if peppol_context.result != result:\n            print(f&amp;quot;result: {peppol_context.result}&amp;quot;)\n            print(f&amp;quot;expecting: {result}&amp;quot;)\n&amp;gt;       assert peppol_context.result == result\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE       AssertionError\n\nsrc/pac_bdd/peppol.py:129: AssertionError\n\n----------------------------- Captured stdout call -----------------------------\nresult: b881aaeff8eeaed7190491ccdeaa42fc\nexpecting: 6c2675d749449f2c8af1216fd866bb54\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte md5 de &amp;quot;bonjour!&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte md5 de &amp;quot;{msg}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;, &amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;6c2675d749449f2c8af1216fd866bb54&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_identification_france&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_identification_france&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_identification_france&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\nxxxx 0002 0002\nxxxx 0009 0009\nxxxx 9957 9957\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_l\\&amp;#x27;identification par SIRET porte le code &amp;quot;0002&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_l\\&amp;#x27;identification par {facon} porte le code &amp;quot;{code}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_l\\&amp;#x27;identification par SIREN porte le code &amp;quot;0009&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_l\\&amp;#x27;identification par {facon} porte le code &amp;quot;{code}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_l\\&amp;#x27;identification par TVA_FR porte le code &amp;quot;9957&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_l\\&amp;#x27;identification par {facon} porte le code &amp;quot;{code}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_empreinte_participant&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_empreinte_participant&#34;, &#34;duration&#34;: &#34;3 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_empreinte_participant&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;3 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte SIREN &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;3ddb2999105b666703fc700e14885016&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte SIRET &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;6dbdf4f29451b37456ca48b550bdbaee&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte TVA_FR &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;d0d6bafc0317e3e8baa9504a9a022f9c&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_h\u00f4te_sml&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_h\u00f4te_sml&#34;, &#34;duration&#34;: &#34;5 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_h\u00f4te_sml&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;5 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_la racine SML &amp;quot;ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_la racine SML &amp;quot;{zone}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIREN &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-3ddb2999105b666703fc700e14885016.iso6523-actorid-upis.ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIRET &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-6dbdf4f29451b37456ca48b550bdbaee.iso6523-actorid-upis.ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour TVA_FR &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-d0d6bafc0317e3e8baa9504a9a022f9c.iso6523-actorid-upis.ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_la racine SML &amp;quot;acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_la racine SML &amp;quot;{zone}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIREN &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-3ddb2999105b666703fc700e14885016.iso6523-actorid-upis.acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIRET &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-6dbdf4f29451b37456ca48b550bdbaee.iso6523-actorid-upis.acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour TVA_FR &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-d0d6bafc0317e3e8baa9504a9a022f9c.iso6523-actorid-upis.acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_rejet_dolibarr&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_rejet_dolibarr&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_rejet_dolibarr&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function compliance_rule_set at 0x7a52a4d89ee0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_rejet_dolibarr&amp;gt;&amp;gt;, kwargs = {}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\n    @when(&amp;quot;je d\u00e9finis un contr\u00f4le de conformit\u00e9 m\u00e9tier fournisseur&amp;quot;)\n    def compliance_rule_set():\n&amp;gt;       raise NotImplementedError()\nE       NotImplementedError\n\nsrc/pac_bdd/tobeimplemented.py:45: NotImplementedError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je d\u00e9finis un contr\u00f4le de conformit\u00e9 m\u00e9tier fournisseur&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je d\u00e9finis un contr\u00f4le de conformit\u00e9 m\u00e9tier fournisseur&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_facture_rejet\u00e9e&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_facture_rejet\u00e9e&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_facture_rejet\u00e9e&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function submit_invoice_simple at 0x7a52a4d89440&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_facture_rejet\u00e9e&amp;gt;&amp;gt;, kwargs = {}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\n    @when(&amp;quot;je d\u00e9pose une facture&amp;quot;)\n    def submit_invoice_simple():\n        # POST /\n&amp;gt;       raise NotImplementedError()\nE       NotImplementedError\n\nsrc/pac_bdd/tobeimplemented.py:17: NotImplementedError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je d\u00e9pose une facture&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je d\u00e9pose une facture&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}]}, &#34;renderCollapsed&#34;: [&#34;passed&#34;], &#34;initialSort&#34;: &#34;result&#34;, &#34;title&#34;: &#34;report.html&#34;}"></div>
    <script>
      (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
const { getCollapsedCategory, setCollapsedIds } = require('./storage.js')

class DataManager {
    setManager(data) {
        const collapsedCategories = [...getCollapsedCategory(data.renderCollapsed)]
        const collapsedIds = []
        const tests = Object.values(data.tests).flat().map((test, index) => {
            const collapsed = collapsedCategories.includes(test.result.toLowerCase())
            const id = `test_${index}`
            if (collapsed) {
                collapsedIds.push(id)
            }
            return {
                ...test,
                id,
                collapsed,
            }
        })
        const dataBlob = { ...data, tests }
        this.data = { ...dataBlob }
        this.renderData = { ...dataBlob }
        setCollapsedIds(collapsedIds)
    }

    get allData() {
        return { ...this.data }
    }

    resetRender() {
        this.renderData = { ...this.data }
    }

    setRender(data) {
        this.renderData.tests = [...data]
    }

    toggleCollapsedItem(id) {
        this.renderData.tests = this.renderData.tests.map((test) =>
            test.id === id ? { ...test, collapsed: !test.collapsed } : test,
        )
    }

    set allCollapsed(collapsed) {
        this.renderData = { ...this.renderData, tests: [...this.renderData.tests.map((test) => (
            { ...test, collapsed }
        ))] }
    }

    get testSubset() {
        return [...this.renderData.tests]
    }

    get environment() {
        return this.renderData.environment
    }

    get initialSort() {
        return this.data.initialSort
    }
}

module.exports = {
    manager: new DataManager(),
}

},{"./storage.js":8}],2:[function(require,module,exports){
const mediaViewer = require('./mediaviewer.js')
const templateEnvRow = document.getElementById('template_environment_row')
const templateResult = document.getElementById('template_results-table__tbody')

function htmlToElements(html) {
    const temp = document.createElement('template')
    temp.innerHTML = html
    return temp.content.childNodes
}

const find = (selector, elem) => {
    if (!elem) {
        elem = document
    }
    return elem.querySelector(selector)
}

const findAll = (selector, elem) => {
    if (!elem) {
        elem = document
    }
    return [...elem.querySelectorAll(selector)]
}

const dom = {
    getStaticRow: (key, value) => {
        const envRow = templateEnvRow.content.cloneNode(true)
        const isObj = typeof value === 'object' && value !== null
        const values = isObj ? Object.keys(value).map((k) => `${k}: ${value[k]}`) : null

        const valuesElement = htmlToElements(
            values ? `<ul>${values.map((val) => `<li>${val}</li>`).join('')}<ul>` : `<div>${value}</div>`)[0]
        const td = findAll('td', envRow)
        td[0].textContent = key
        td[1].appendChild(valuesElement)

        return envRow
    },
    getResultTBody: ({ testId, id, log, extras, resultsTableRow, tableHtml, result, collapsed }) => {
        const resultBody = templateResult.content.cloneNode(true)
        resultBody.querySelector('tbody').classList.add(result.toLowerCase())
        resultBody.querySelector('tbody').id = testId
        resultBody.querySelector('.collapsible').dataset.id = id

        resultsTableRow.forEach((html) => {
            const t = document.createElement('template')
            t.innerHTML = html
            resultBody.querySelector('.collapsible').appendChild(t.content)
        })

        if (log) {
            // Wrap lines starting with "E" with span.error to color those lines red
            const wrappedLog = log.replace(/^E.*$/gm, (match) => `<span class="error">${match}</span>`)
            resultBody.querySelector('.log').innerHTML = wrappedLog
        } else {
            resultBody.querySelector('.log').remove()
        }

        if (collapsed) {
            resultBody.querySelector('.collapsible > td')?.classList.add('collapsed')
            resultBody.querySelector('.extras-row').classList.add('hidden')
        } else {
            resultBody.querySelector('.collapsible > td')?.classList.remove('collapsed')
        }

        const media = []
        extras?.forEach(({ name, format_type, content }) => {
            if (['image', 'video'].includes(format_type)) {
                media.push({ path: content, name, format_type })
            }

            if (format_type === 'html') {
                resultBody.querySelector('.extraHTML').insertAdjacentHTML('beforeend', `<div>${content}</div>`)
            }
        })
        mediaViewer.setup(resultBody, media)

        // Add custom html from the pytest_html_results_table_html hook
        tableHtml?.forEach((item) => {
            resultBody.querySelector('td[class="extra"]').insertAdjacentHTML('beforeend', item)
        })

        return resultBody
    },
}

module.exports = {
    dom,
    htmlToElements,
    find,
    findAll,
}

},{"./mediaviewer.js":6}],3:[function(require,module,exports){
const { manager } = require('./datamanager.js')
const { doSort } = require('./sort.js')
const storageModule = require('./storage.js')

const getFilteredSubSet = (filter) =>
    manager.allData.tests.filter(({ result }) => filter.includes(result.toLowerCase()))

const doInitFilter = () => {
    const currentFilter = storageModule.getVisible()
    const filteredSubset = getFilteredSubSet(currentFilter)
    manager.setRender(filteredSubset)
}

const doFilter = (type, show) => {
    if (show) {
        storageModule.showCategory(type)
    } else {
        storageModule.hideCategory(type)
    }

    const currentFilter = storageModule.getVisible()
    const filteredSubset = getFilteredSubSet(currentFilter)
    manager.setRender(filteredSubset)

    const sortColumn = storageModule.getSort()
    doSort(sortColumn, true)
}

module.exports = {
    doFilter,
    doInitFilter,
}

},{"./datamanager.js":1,"./sort.js":7,"./storage.js":8}],4:[function(require,module,exports){
const { redraw, bindEvents, renderStatic } = require('./main.js')
const { doInitFilter } = require('./filter.js')
const { doInitSort } = require('./sort.js')
const { manager } = require('./datamanager.js')
const data = JSON.parse(document.getElementById('data-container').dataset.jsonblob)

function init() {
    manager.setManager(data)
    doInitFilter()
    doInitSort()
    renderStatic()
    redraw()
    bindEvents()
}

init()

},{"./datamanager.js":1,"./filter.js":3,"./main.js":5,"./sort.js":7}],5:[function(require,module,exports){
const { dom, find, findAll } = require('./dom.js')
const { manager } = require('./datamanager.js')
const { doSort } = require('./sort.js')
const { doFilter } = require('./filter.js')
const {
    getVisible,
    getCollapsedIds,
    setCollapsedIds,
    getSort,
    getSortDirection,
    possibleFilters,
} = require('./storage.js')

const removeChildren = (node) => {
    while (node.firstChild) {
        node.removeChild(node.firstChild)
    }
}

const renderStatic = () => {
    const renderEnvironmentTable = () => {
        const environment = manager.environment
        const rows = Object.keys(environment).map((key) => dom.getStaticRow(key, environment[key]))
        const table = document.getElementById('environment')
        removeChildren(table)
        rows.forEach((row) => table.appendChild(row))
    }
    renderEnvironmentTable()
}

const addItemToggleListener = (elem) => {
    elem.addEventListener('click', ({ target }) => {
        const id = target.parentElement.dataset.id
        manager.toggleCollapsedItem(id)

        const collapsedIds = getCollapsedIds()
        if (collapsedIds.includes(id)) {
            const updated = collapsedIds.filter((item) => item !== id)
            setCollapsedIds(updated)
        } else {
            collapsedIds.push(id)
            setCollapsedIds(collapsedIds)
        }
        redraw()
    })
}

const renderContent = (tests) => {
    const sortAttr = getSort(manager.initialSort)
    const sortAsc = JSON.parse(getSortDirection())
    const rows = tests.map(dom.getResultTBody)
    const table = document.getElementById('results-table')
    const tableHeader = document.getElementById('results-table-head')

    const newTable = document.createElement('table')
    newTable.id = 'results-table'

    // remove all sorting classes and set the relevant
    findAll('.sortable', tableHeader).forEach((elem) => elem.classList.remove('asc', 'desc'))
    tableHeader.querySelector(`.sortable[data-column-type="${sortAttr}"]`)?.classList.add(sortAsc ? 'desc' : 'asc')
    newTable.appendChild(tableHeader)

    if (!rows.length) {
        const emptyTable = document.getElementById('template_results-table__body--empty').content.cloneNode(true)
        newTable.appendChild(emptyTable)
    } else {
        rows.forEach((row) => {
            if (!!row) {
                findAll('.collapsible td:not(.col-links', row).forEach(addItemToggleListener)
                find('.logexpander', row).addEventListener('click',
                    (evt) => evt.target.parentNode.classList.toggle('expanded'),
                )
                newTable.appendChild(row)
            }
        })
    }

    table.replaceWith(newTable)
}

const renderDerived = () => {
    const currentFilter = getVisible()
    possibleFilters.forEach((result) => {
        const input = document.querySelector(`input[data-test-result="${result}"]`)
        input.checked = currentFilter.includes(result)
    })
}

const bindEvents = () => {
    const filterColumn = (evt) => {
        const { target: element } = evt
        const { testResult } = element.dataset

        doFilter(testResult, element.checked)
        const collapsedIds = getCollapsedIds()
        const updated = manager.renderData.tests.map((test) => {
            return {
                ...test,
                collapsed: collapsedIds.includes(test.id),
            }
        })
        manager.setRender(updated)
        redraw()
    }

    const header = document.getElementById('environment-header')
    header.addEventListener('click', () => {
        const table = document.getElementById('environment')
        table.classList.toggle('hidden')
        header.classList.toggle('collapsed')
    })

    findAll('input[name="filter_checkbox"]').forEach((elem) => {
        elem.addEventListener('click', filterColumn)
    })

    findAll('.sortable').forEach((elem) => {
        elem.addEventListener('click', (evt) => {
            const { target: element } = evt
            const { columnType } = element.dataset
            doSort(columnType)
            redraw()
        })
    })

    document.getElementById('show_all_details').addEventListener('click', () => {
        manager.allCollapsed = false
        setCollapsedIds([])
        redraw()
    })
    document.getElementById('hide_all_details').addEventListener('click', () => {
        manager.allCollapsed = true
        const allIds = manager.renderData.tests.map((test) => test.id)
        setCollapsedIds(allIds)
        redraw()
    })
}

const redraw = () => {
    const { testSubset } = manager

    renderContent(testSubset)
    renderDerived()
}

module.exports = {
    redraw,
    bindEvents,
    renderStatic,
}

},{"./datamanager.js":1,"./dom.js":2,"./filter.js":3,"./sort.js":7,"./storage.js":8}],6:[function(require,module,exports){
class MediaViewer {
    constructor(assets) {
        this.assets = assets
        this.index = 0
    }

    nextActive() {
        this.index = this.index === this.assets.length - 1 ? 0 : this.index + 1
        return [this.activeFile, this.index]
    }

    prevActive() {
        this.index = this.index === 0 ? this.assets.length - 1 : this.index -1
        return [this.activeFile, this.index]
    }

    get currentIndex() {
        return this.index
    }

    get activeFile() {
        return this.assets[this.index]
    }
}


const setup = (resultBody, assets) => {
    if (!assets.length) {
        resultBody.querySelector('.media').classList.add('hidden')
        return
    }

    const mediaViewer = new MediaViewer(assets)
    const container = resultBody.querySelector('.media-container')
    const leftArrow = resultBody.querySelector('.media-container__nav--left')
    const rightArrow = resultBody.querySelector('.media-container__nav--right')
    const mediaName = resultBody.querySelector('.media__name')
    const counter = resultBody.querySelector('.media__counter')
    const imageEl = resultBody.querySelector('img')
    const sourceEl = resultBody.querySelector('source')
    const videoEl = resultBody.querySelector('video')

    const setImg = (media, index) => {
        if (media?.format_type === 'image') {
            imageEl.src = media.path

            imageEl.classList.remove('hidden')
            videoEl.classList.add('hidden')
        } else if (media?.format_type === 'video') {
            sourceEl.src = media.path

            videoEl.classList.remove('hidden')
            imageEl.classList.add('hidden')
        }

        mediaName.innerText = media?.name
        counter.innerText = `${index + 1} / ${assets.length}`
    }
    setImg(mediaViewer.activeFile, mediaViewer.currentIndex)

    const moveLeft = () => {
        const [media, index] = mediaViewer.prevActive()
        setImg(media, index)
    }
    const doRight = () => {
        const [media, index] = mediaViewer.nextActive()
        setImg(media, index)
    }
    const openImg = () => {
        window.open(mediaViewer.activeFile.path, '_blank')
    }
    if (assets.length === 1) {
        container.classList.add('media-container--fullscreen')
    } else {
        leftArrow.addEventListener('click', moveLeft)
        rightArrow.addEventListener('click', doRight)
    }
    imageEl.addEventListener('click', openImg)
}

module.exports = {
    setup,
}

},{}],7:[function(require,module,exports){
const { manager } = require('./datamanager.js')
const storageModule = require('./storage.js')

const genericSort = (list, key, ascending, customOrder) => {
    let sorted
    if (customOrder) {
        sorted = list.sort((a, b) => {
            const aValue = a.result.toLowerCase()
            const bValue = b.result.toLowerCase()

            const aIndex = customOrder.findIndex((item) => item.toLowerCase() === aValue)
            const bIndex = customOrder.findIndex((item) => item.toLowerCase() === bValue)

            // Compare the indices to determine the sort order
            return aIndex - bIndex
        })
    } else {
        sorted = list.sort((a, b) => a[key] === b[key] ? 0 : a[key] > b[key] ? 1 : -1)
    }

    if (ascending) {
        sorted.reverse()
    }
    return sorted
}

const durationSort = (list, ascending) => {
    const parseDuration = (duration) => {
        if (duration.includes(':')) {
            // If it's in the format "HH:mm:ss"
            const [hours, minutes, seconds] = duration.split(':').map(Number)
            return (hours * 3600 + minutes * 60 + seconds) * 1000
        } else {
            // If it's in the format "nnn ms"
            return parseInt(duration)
        }
    }
    const sorted = list.sort((a, b) => parseDuration(a['duration']) - parseDuration(b['duration']))
    if (ascending) {
        sorted.reverse()
    }
    return sorted
}

const doInitSort = () => {
    const type = storageModule.getSort(manager.initialSort)
    const ascending = storageModule.getSortDirection()
    const list = manager.testSubset
    const initialOrder = ['Error', 'Failed', 'Rerun', 'XFailed', 'XPassed', 'Skipped', 'Passed']

    storageModule.setSort(type)
    storageModule.setSortDirection(ascending)

    if (type?.toLowerCase() === 'original') {
        manager.setRender(list)
    } else {
        let sortedList
        switch (type) {
        case 'duration':
            sortedList = durationSort(list, ascending)
            break
        case 'result':
            sortedList = genericSort(list, type, ascending, initialOrder)
            break
        default:
            sortedList = genericSort(list, type, ascending)
            break
        }
        manager.setRender(sortedList)
    }
}

const doSort = (type, skipDirection) => {
    const newSortType = storageModule.getSort(manager.initialSort) !== type
    const currentAsc = storageModule.getSortDirection()
    let ascending
    if (skipDirection) {
        ascending = currentAsc
    } else {
        ascending = newSortType ? false : !currentAsc
    }
    storageModule.setSort(type)
    storageModule.setSortDirection(ascending)

    const list = manager.testSubset
    const sortedList = type === 'duration' ? durationSort(list, ascending) : genericSort(list, type, ascending)
    manager.setRender(sortedList)
}

module.exports = {
    doInitSort,
    doSort,
}

},{"./datamanager.js":1,"./storage.js":8}],8:[function(require,module,exports){
const possibleFilters = [
    'passed',
    'skipped',
    'failed',
    'error',
    'xfailed',
    'xpassed',
    'rerun',
]

const getVisible = () => {
    const url = new URL(window.location.href)
    const settings = new URLSearchParams(url.search).get('visible')
    const lower = (item) => {
        const lowerItem = item.toLowerCase()
        if (possibleFilters.includes(lowerItem)) {
            return lowerItem
        }
        return null
    }
    return settings === null ?
        possibleFilters :
        [...new Set(settings?.split(',').map(lower).filter((item) => item))]
}

const hideCategory = (categoryToHide) => {
    const url = new URL(window.location.href)
    const visibleParams = new URLSearchParams(url.search).get('visible')
    const currentVisible = visibleParams ? visibleParams.split(',') : [...possibleFilters]
    const settings = [...new Set(currentVisible)].filter((f) => f !== categoryToHide).join(',')

    url.searchParams.set('visible', settings)
    window.history.pushState({}, null, unescape(url.href))
}

const showCategory = (categoryToShow) => {
    if (typeof window === 'undefined') {
        return
    }
    const url = new URL(window.location.href)
    const currentVisible = new URLSearchParams(url.search).get('visible')?.split(',').filter(Boolean) ||
        [...possibleFilters]
    const settings = [...new Set([categoryToShow, ...currentVisible])]
    const noFilter = possibleFilters.length === settings.length || !settings.length

    noFilter ? url.searchParams.delete('visible') : url.searchParams.set('visible', settings.join(','))
    window.history.pushState({}, null, unescape(url.href))
}

const getSort = (initialSort) => {
    const url = new URL(window.location.href)
    let sort = new URLSearchParams(url.search).get('sort')
    if (!sort) {
        sort = initialSort || 'result'
    }
    return sort
}

const setSort = (type) => {
    const url = new URL(window.location.href)
    url.searchParams.set('sort', type)
    window.history.pushState({}, null, unescape(url.href))
}

const getCollapsedCategory = (renderCollapsed) => {
    let categories
    if (typeof window !== 'undefined') {
        const url = new URL(window.location.href)
        const collapsedItems = new URLSearchParams(url.search).get('collapsed')
        switch (true) {
        case !renderCollapsed && collapsedItems === null:
            categories = ['passed']
            break
        case collapsedItems?.length === 0 || /^["']{2}$/.test(collapsedItems):
            categories = []
            break
        case /^all$/.test(collapsedItems) || collapsedItems === null && /^all$/.test(renderCollapsed):
            categories = [...possibleFilters]
            break
        default:
            categories = collapsedItems?.split(',').map((item) => item.toLowerCase()) || renderCollapsed
            break
        }
    } else {
        categories = []
    }
    return categories
}

const getSortDirection = () => JSON.parse(sessionStorage.getItem('sortAsc')) || false
const setSortDirection = (ascending) => sessionStorage.setItem('sortAsc', ascending)

const getCollapsedIds = () => JSON.parse(sessionStorage.getItem('collapsedIds')) || []
const setCollapsedIds = (list) => sessionStorage.setItem('collapsedIds', JSON.stringify(list))

module.exports = {
    getVisible,
    hideCategory,
    showCategory,
    getCollapsedIds,
    setCollapsedIds,
    getSort,
    setSort,
    getSortDirection,
    setSortDirection,
    getCollapsedCategory,
    possibleFilters,
}

},{}]},{},[4]);
    </script>
  </footer>
</html>